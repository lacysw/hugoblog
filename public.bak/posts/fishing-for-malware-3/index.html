<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Fishing for Malware — Part Three: WannaCry | Sid's Blog</title>
<meta name=keywords content="sid,lacy,blog,website,cybersecurity,security,computer,honeypot,malware,tech,network,wannacry">
<meta name=description content="Analysis of malware dropped into my Google Cloud honeypot – WannaCry">
<meta name=author content="Sid Lacy">
<link rel=canonical href=https://swlacy.com/posts/fishing-for-malware-3/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.57f2b6dfb92097eb855e02e905de3644361ad2fc5089352e89b93d9a43712dd5.css integrity="sha256-V/K237kgl+uFXgLpBd42RDYa0vxQiTUuibk9mkNxLdU=" rel="preload stylesheet" as=style>
<link rel=preload href=apple-touch-icon.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://swlacy.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://swlacy.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://swlacy.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://swlacy.com/apple-touch-icon.png>
<link rel=mask-icon href=https://swlacy.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QFRYSRDLC1"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QFRYSRDLC1',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Fishing for Malware — Part Three: WannaCry">
<meta property="og:description" content="Analysis of malware dropped into my Google Cloud honeypot – WannaCry">
<meta property="og:type" content="article">
<meta property="og:url" content="https://swlacy.com/posts/fishing-for-malware-3/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-25T00:00:00+00:00">
<meta property="article:modified_time" content="2022-01-25T00:00:00+00:00"><meta property="og:site_name" content="Sid's Blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Fishing for Malware — Part Three: WannaCry">
<meta name=twitter:description content="Analysis of malware dropped into my Google Cloud honeypot – WannaCry">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://swlacy.com/posts/"},{"@type":"ListItem","position":3,"name":"Fishing for Malware — Part Three: WannaCry","item":"https://swlacy.com/posts/fishing-for-malware-3/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fishing for Malware — Part Three: WannaCry","name":"Fishing for Malware — Part Three: WannaCry","description":"Analysis of malware dropped into my Google Cloud honeypot – WannaCry","keywords":["sid","lacy","blog","website","cybersecurity","security","computer","honeypot","malware","tech","network","wannacry"],"articleBody":"⇤ Start from the beginning\nCatching WannaCry One very interesting binary uploaded to my honeypot not only once, but several times from multiple hosts around the world, was WannaCry. Yes, nearly five years after the Shadow Brokers sold the NSA’s EternalBlue exploit to the notorious Pyongyang-based (alleged) Lazarus Group, who then developed and released WannaCry, one of the most damaging ransomware packages is still in active distribution.\nEven after Marcus Hutchins discovered and published WannaCry’s “kill switch” and Microsoft patched EternalBlue, WannaCry remains a dangerous binary. After all, the age-old logic that it is somehow more reasonable to risk the exorbitant cost of malware damages than to pay for sound security architecture sadly remains to this day. So, given that I am now in possession of over a dozen permutations of WannaCry, what is the obvious next step? Of course, to execute it!\nExecuting WannaCry Preparing the Environment Because I care quite deeply about the security of my home network, I have offloaded the risk of knowingly running malware onto Microsoft via Azure. Thank you for supporting my student endeavors, Microsoft. Azure still supports Windows 7, so I deployed an image of Windows 7 Enterprise with the following technical specs:\nSecurity type Standard Image Windows 7 Enterprise - Gen1 Size Standard B2ms (2 vcpus, 8 GiB memory) OS disk type Premium SSD LRS To ensure maximum damage by WannaCry, I also uninstalled every Windows update via a generated Batch script using the kind advice of users M.Josh and imansejati on the Microsoft Forums. Removing feature updates was unnecessary, but it was easier to simply remove every KB* update, which includes all of those intended for security purposes. The full script can be found here, a preview of which is below:\nwusa /uninstall /KB:2849697 /quiet /norestart wusa /uninstall /KB:2849696 /quiet /norestart wusa /uninstall /KB:2841134 /quiet /norestart wusa /uninstall /KB:2670838 /quiet /norestart wusa /uninstall /KB:2479943 /quiet /norestart wusa /uninstall /KB:2491683 /quiet /norestart ... (+188 more) While I waited for the updates to be uninstalled, I was struck by just how unbearably nostalgic the Windows 7 acrylic design scheme is. Sadly, it seems that Azure images of Windows 7 aren’t provisioned with MS Solitaire or Purble Place… Good memories, nonetheless; it was on Windows 7 that I gained an appreciation for computing and security in general. I recall creating prank “games” with my friends on the computers in middle school that would power off the PC if the user lost, or make the LOCK indicators on the keyboards flash non-stop with VBA. A time bound to the past, for sure. I can’t imagine shell access on middle school student accounts these days, let alone unrestricted, editable access to student registration information on network drives mounted to every PC in the domain.\nI also disabled Windows Firewall, and then proceed on to Windows Defender — right, Windows 7 doesn’t have Windows Defender, or any real-time AV, configured by default. A notification in the Action Center urgently warned me to “Find an antivirus program online (Important).” Combined with the way Windows handles privilege escalation, it is no wonder that Windows is notorious for security issues.\nFinally, after waiting for significantly longer than I had anticipated, all updates were uninstalled, and the PC restarted.\nC:\\Users\\slakwmic qfe get hotfixid HotFixID C:\\Users\\slak As a reminder, I had also uninstalled feature updates, which left the desktop post-reboot with all the classical charm of Windows 2000.\nOf course, the desktop didn’t look like this for long — executing wannacry.exe yielded the following shortly after.\nPost-Execution Success! WannaCry was active and my files were encrypted, all with strange WannaCry-specific file extensions… In a different context, I’m sure I would be quite upset here.\nSome elements of the WannaCry GUI stood out to me in particular: the Check Payment and Contact Us buttons. Both, of course, imply the requirement for outbound requests to a foreign server. In light of that, I attempted to set up Wireshark and TCPview to see where requests are sent. However, as can be seen below, neither program functioned as expected, both either crashing instantly or failing to bind to network interfaces. Whether this is due to interference by WannaCry or something else, I am not sure.\nEven though TCPview nor Wireshark operated as expected, in blue below, I have boxed some outgoing connections found with netstat while requesting payment information:\nHere are the highlighted addresses with relation to their associated WHOIS registration info:\nAddress Location Owner 168.63.129.16 Hong Kong Aberdeen Microsoft Corp 20.150.30.132 Phoenix, AZ Microsoft Corp 20.60.14.132 Phoenix, AZ Microsoft Corp I had either missed the connection or it had never originated in the first place; alternatively, the malware host was listening for connections using Azure. Further toying with WannaCry revealed that the timer could be modified using the system clock! Setting the time in Windows to several days in the future — thus missing the first payment deadline — raised the file ransom from USD 300 to USD 600.\nSo, then, what happens if the second deadline expires as well? Unfortunately, nothing, so it seems. The timer runs out but then… Well, the files remain. Not even a pop-up — rather anticlimactic. Further, resetting the system clock refilled the timers and lowered the requested payment back to USD 300.\nSpeaking of payment, the transaction history of the Bitcoin ransom address can be seen here, but to summarize:\n This address has transacted 124 times on the Bitcoin blockchain. It has received a total of 14.87769994 BTC ($522,558.23) and has sent a total of 14.41067602 BTC ($506,154.68). The current value of this address is 0.46702392 BTC ($16,403.56).\n Finally, attempting to send a message via the Contact Us link, which spawned a text entry box, revealed the following, which leads me to believe that finding a valid connection endpoint would have ultimately been useless, as it would have simply been a TOR node.\nOverall, while WannaCry isn’t as intimidating as in times past, it was still fun to play around with. If the Bitcoin transaction history is indicative of anything, it’s that a very profitable subsection of users still open their computers to see WannaCry’s infamous red GUI.\nExamining WannaCry with Ghidra WannaCry has, so far, been only superficially exposed in this post, but Ghidra can be used to dive deeper. Before proceeding, I would like to note that I am not by any means proficient, or even knowledgeable, regarding the process of reverse engineering. I am still a student; it is my hope, however, that others might learn as much as I have by reading further.\nFirst, some information regarding the executable:\n$ file wannacry wannacry: PE32 executable (GUI) Intel 80386, for MS Windows $ strings wannacry ... CryptAcquireContextA CryptGenRandom ... InternetCloseHandle InternetOpenUrlA InternetOpenA .. CryptAcquireContextA CryptGenRandom ... SMBs SMBr SMBs SMB+ ... In particular, consider the following URL.\n$ strings wannacry | grep 'http\\|https' http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com $ curl http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com  html lang=\"en-us\" class=\"no-js\" head meta charset=\"utf-8\" titleSinkholed by Kryptos Logictitle meta name=\"description\" content=\"Kryptos Logic Sinkhole\" meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" link href=\"//static.kryptoslogicsinkhole.com/style.css\" rel=\"stylesheet\" type=\"text/css\"/ head body class=\"flat\" div class=\"content\" div class=\"content-box\" div class=\"big-content\" div class=\"clear\"div div h1Sinkholed!h1 pThis domain has been sinkholed by a href=\"https://www.kryptoslogic.com\"Kryptos Logica.p div div body html The domain has since been captured, but from a cursory Google search, my understanding is that this was one of the kill-switch sites used to neutralize WannaCry. Here is Ghidra’s best attempt to reconstruct the function containing the URL:\nundefined4 FUN_00408140(void) { undefined4 uVar1; int iVar2; undefined4 *puVar3; undefined4 *puVar4; undefined4 uStack100; undefined4 uStack96; undefined4 uStack92; undefined4 local_50 [14]; undefined4 local_17; undefined4 local_13; undefined4 local_f; undefined4 local_b; undefined4 local_7; undefined2 local_3; undefined local_1; puVar3 = (undefined4 *)s_http://www.iuqerfsodp9ifjaposdfj_004313d0;  puVar4 = local_50; for (iVar2 = 0xe; iVar2 != 0; iVar2 = iVar2 + -1) { *puVar4 = *puVar3; puVar3 = puVar3 + 1; puVar4 = puVar4 + 1; } *(undefined *)puVar4 = *(undefined *)puVar3; local_17 = 0; local_13 = 0; local_f = 0; local_b = 0; local_7 = 0; local_3 = 0; uStack92 = 0; uStack96 = 0; uStack100 = 0; local_1 = 0; uVar1 = InternetOpenA(0,1); iVar2 = InternetOpenUrlA(uVar1,\u0026uStack100,0,0,0x84000000,0); if (iVar2 == 0) { InternetCloseHandle(uVar1); InternetCloseHandle(0); FUN_00408090(); return 0; } InternetCloseHandle(uVar1); InternetCloseHandle(iVar2); return 0; } It appears that InternetOpenA(), for example, is a system call to a function in Microsoft’s own WININET.DLL, as shown below, which is contained within the wininet.h header.\nff 15 34 a1 40 00 CALL dword ptr [WININET.DLL::InternetOpenA] Microsoft says that InternetOpenA() “initializes an application’s use of the WinINet functions.” WannaCry then uses InternetOpenUrlA(), which, also per Microsoft documentation, “opens a resource specified by a complete FTP or HTTP URL.”\nConsider, then, the following excerpt from The Conversation’s 2017 article about WannaCry, Here’s how the ransomware attack was stopped – and why it could soon start again:\n In the case of WannaCry, a researcher using the pseudonym MalwareTech ended up accidentally activating the kill switch when he tried to create a sinkhole in order to study the software. WannaCry included code that looked to check if a specified domain had been registered. If it received a response from the domain, it shut down. If not, it continued to work. So when MalwareTech registered the domain, it effectively activated the kill switch.\n So, then, Ghidra’s disassembly from above could presumably be annotated with comments like so:\n... uVar1 = InternetOpenA(0,1); // Initialize WinInit capability  iVar2 = InternetOpenUrlA(uVar1,\u0026uStack100,0,0,0x84000000,0); // Check for a response from the URL  if (iVar2 == 0) { // If no reponse is received, as domain is unregistered  InternetCloseHandle(uVar1); // Close the socket  InternetCloseHandle(0); // Close the socket  FUN_00408090(); // !! PROCEED WITH WANNACRY !!  return 0; } // Otherwise, just close the socket and quit without executing WannaCry  InternetCloseHandle(uVar1); InternetCloseHandle(iVar2); return 0; } Conclusion By this point, my disassembly-related technical skill had been exhausted. Overall, this has certainly been one of the most interesting parts of my honeypot project thus far. Thank you so much for reading and stay tuned; more posts in my Fishing for Malware series will be published soon.\n Fishing for Malware: Part 4 →\n← Fishing for Malware: Part 2\nI am open to comments and criticism — I learn alongside you. Please, do not hesitate to suggest an edit.\n Sid Lacy\nEmail • LinkedIn • GitHub\n","wordCount":"1699","inLanguage":"en","datePublished":"2022-01-25T00:00:00Z","dateModified":"2022-01-25T00:00:00Z","author":[{"@type":"Person","name":"Sid Lacy"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://swlacy.com/posts/fishing-for-malware-3/"},"publisher":{"@type":"Organization","name":"Sid's Blog","logo":{"@type":"ImageObject","url":"https://swlacy.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add('dark')</script>
<header class=header>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/base16/espresso.min.css integrity="sha512-Alf9gBIx7O9Pn9+n7HJXcwZK6uXCaGDNj5ScAAtNsQ5OpUHBaXLEAaX00Z9N8S9o9lTG7FKgnRB5eXwUQKNu6g==" crossorigin=anonymous referrerpolicy=no-referrer>
<nav class=nav>
<div class=logo>
<a href=https://swlacy.com accesskey=h title=Home>
<img src=https://swlacy.com/apple-touch-icon.png alt=logo aria-label=logo height=" 21px">Sid's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="Toggle Dark Mode"><svg id="moon" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg><svg id="sun" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://swlacy.com/posts title=Search>
<span>Blog</span>
</a>
</li>
<li>
<a href=https://swlacy.com/documents title=Search>
<span>Docs</span>
</a>
</li>
<li>
<a href=https://swlacy.com/resume title=Search>
<span>Resume</span>
</a>
</li>
<li>
<a href=https://swlacy.com/about title=Search>
<span>About</span>
</a>
</li>
<li>
<a href=https://swlacy.com/archive title=Search>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://swlacy.com/search title=Search accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://swlacy.com>Home</a>&nbsp;»&nbsp;<a href=https://swlacy.com/posts/>Posts</a></div>
<h1 class=post-title>
Fishing for Malware — Part Three: WannaCry
</h1>
<div class=post-description>
Analysis of malware dropped into my Google Cloud honeypot – WannaCry
</div>
<div class=post-meta><span title="2022-01-25 00:00:00 +0000 UTC">January 25, 2022</span>&nbsp;·&nbsp;8 Minute Read&nbsp;·&nbsp;Sid Lacy
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#catching-wannacry aria-label="Catching WannaCry">Catching WannaCry</a></li>
<li>
<a href=#executing-wannacry aria-label="Executing WannaCry">Executing WannaCry</a><ul>
<li>
<a href=#preparing-the-environment aria-label="Preparing the Environment">Preparing the Environment</a></li>
<li>
<a href=#post-execution aria-label=Post-Execution>Post-Execution</a></li></ul>
</li>
<li>
<a href=#examining-wannacry-with-ghidra aria-label="Examining WannaCry with Ghidra">Examining WannaCry with Ghidra</a></li>
<li>
<a href=#conclusion aria-label=Conclusion>Conclusion</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p><strong><a href=/media/fishing-for-malware-1>⇤ Start from the beginning</a></strong></p>
<h2 id=catching-wannacry>Catching WannaCry<a hidden class=anchor aria-hidden=true href=#catching-wannacry>#</a></h2>
<p>One very interesting binary uploaded to my honeypot not only once, but several times from multiple hosts around the world, was <a href=https://www.cisa.gov/uscert/sites/default/files/FactSheets/NCCIC%20ICS_FactSheet_WannaCry_Ransomware_S508C.pdf><em>WannaCry</em></a>. Yes, nearly five years after the <a href=https://www.nytimes.com/2017/11/12/us/nsa-shadow-brokers.html><em>Shadow Brokers</em> sold the NSA&rsquo;s <em>EternalBlue</em> exploit</a> to the notorious Pyongyang-based (alleged) <a href=https://attack.mitre.org/groups/G0032/><em>Lazarus Group</em></a>, who then developed and released WannaCry, one of the most damaging ransomware packages is still in active distribution.</p>
<p>Even after <a href=https://krebsonsecurity.com/2019/07/no-jail-time-for-wannacry-hero/>Marcus Hutchins discovered and published WannaCry&rsquo;s &ldquo;kill switch&rdquo;</a> and <a href=https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010>Microsoft patched EternalBlue</a>, WannaCry remains a dangerous binary. After all, the age-old logic that it is somehow more reasonable to risk the exorbitant cost of malware damages than to pay for sound security architecture sadly remains to this day. So, given that I am now in possession of over a dozen permutations of WannaCry, what is the obvious next step? Of course, to execute it!</p>
<h2 id=executing-wannacry>Executing WannaCry<a hidden class=anchor aria-hidden=true href=#executing-wannacry>#</a></h2>
<h3 id=preparing-the-environment>Preparing the Environment<a hidden class=anchor aria-hidden=true href=#preparing-the-environment>#</a></h3>
<p>Because I care quite deeply about the security of my home network, I have offloaded the risk of knowingly running malware onto Microsoft via Azure. Thank you for supporting my student endeavors, Microsoft. Azure still supports Windows 7, so I deployed an image of Windows 7 Enterprise with the following technical specs:</p>
<pre tabindex=0><code class=language-none data-lang=none>Security type   Standard
Image           Windows 7 Enterprise - Gen1
Size            Standard B2ms (2 vcpus, 8 GiB memory)
OS disk type    Premium SSD LRS
</code></pre><p>To ensure maximum damage by WannaCry, I also uninstalled every Windows update via a generated Batch script using the <a href=https://answers.microsoft.com/en-us/windows/forum/all/how-can-i-uninstall-all-the-installed-windows/2ac9e797-b9d4-46de-bee3-d93c3c409bda>kind advice</a> of users <em>M.Josh</em> and <em>imansejati</em> on the Microsoft Forums. Removing feature updates was unnecessary, but it was easier to simply remove every <code>KB*</code> update, which includes all of those intended for security purposes. The full script can be found <a href=/files/w7downgrade.cmd>here</a>, a preview of which is below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-batch data-lang=batch>wusa /uninstall /KB:2849697 /quiet /norestart
wusa /uninstall /KB:2849696 /quiet /norestart
wusa /uninstall /KB:2841134 /quiet /norestart
wusa /uninstall /KB:2670838 /quiet /norestart
wusa /uninstall /KB:2479943 /quiet /norestart
wusa /uninstall /KB:2491683 /quiet /norestart
... (+188 more)
</code></pre></div><p><img loading=lazy src=/media/fishing-for-malware-3-1.png alt="Screenshot of my Windows 7 image">
</p>
<p>While I waited for the updates to be uninstalled, I was struck by just how <em>unbearably</em> nostalgic the Windows 7 acrylic design scheme is. Sadly, it seems that Azure images of Windows 7 aren&rsquo;t provisioned with <em>MS Solitaire</em> or <em>Purble Place</em>&mldr; Good memories, nonetheless; it was on Windows 7 that I gained an appreciation for computing and security in general. I recall creating prank &ldquo;games&rdquo; with my friends on the computers in middle school that would power off the PC if the user lost, or make the LOCK indicators on the keyboards flash non-stop with VBA. A time bound to the past, for sure. I can&rsquo;t imagine shell access on middle school student accounts these days, let alone unrestricted, <em>editable</em> access to student registration information on network drives mounted to every PC in the domain.</p>
<p>I also disabled Windows Firewall, and then proceed on to Windows Defender — right, Windows 7 doesn&rsquo;t have Windows Defender, or <em>any</em> real-time AV, configured by default. A notification in the Action Center urgently warned me to &ldquo;Find an antivirus program online (Important).&rdquo; Combined with the way Windows handles privilege escalation, it is no wonder that Windows is notorious for security issues.</p>
<p>Finally, after waiting for significantly longer than I had anticipated, all updates were uninstalled, and the PC restarted.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-batch data-lang=batch>C:\Users\slak<span style=color:#75715e>&gt;wmic qfe get hotfixid</span>
HotFixID

C:\Users\slak<span style=color:#75715e>&gt;</span>
</code></pre></div><p>As a reminder, I had also uninstalled feature updates, which left the desktop post-reboot with all the classical charm of Windows 2000.</p>
<p><img loading=lazy src=/media/fishing-for-malware-3-2.png alt="Screenshot of my Windows post-downgrade">
</p>
<p>Of course, the desktop didn&rsquo;t look like this for long — executing <code>wannacry.exe</code> yielded the following shortly after.</p>
<h3 id=post-execution>Post-Execution<a hidden class=anchor aria-hidden=true href=#post-execution>#</a></h3>
<p><img loading=lazy src=/media/fishing-for-malware-3-3.png alt="Screenshot of my Windows after execution of WannaCry">
</p>
<p>Success! WannaCry was active and my files were encrypted, all with strange WannaCry-specific file extensions&mldr; In a different context, I&rsquo;m sure I would be quite upset here.</p>
<p>Some elements of the WannaCry GUI stood out to me in particular: the <code>Check Payment</code> and <code>Contact Us</code> buttons. Both, of course, imply the requirement for outbound requests to a foreign server. In light of that, I attempted to set up Wireshark and TCPview to see where requests are sent. However, as can be seen below, neither program functioned as expected, both either crashing instantly or failing to bind to network interfaces. Whether this is due to interference by WannaCry or something else, I am not sure.</p>
<p><img loading=lazy src=/media/fishing-for-malware-3-4.png alt="Screenshot of Wireshark and TCPview failure">
</p>
<p>Even though TCPview nor Wireshark operated as expected, in blue below, I have boxed some outgoing connections found with <code>netstat</code> while requesting payment information:</p>
<p><img loading=lazy src=/media/fishing-for-malware-3-5.png alt="Screenshot of netstat connections">
</p>
<p>Here are the highlighted addresses with relation to their associated WHOIS registration info:</p>
<pre tabindex=0><code class=language-none data-lang=none>Address         Location            Owner

168.63.129.16   Hong Kong Aberdeen  Microsoft Corp
20.150.30.132   Phoenix, AZ         Microsoft Corp
20.60.14.132    Phoenix, AZ         Microsoft Corp
</code></pre><p>I had either missed the connection or it had never originated in the first place; alternatively, the malware host was listening for connections using Azure. Further toying with WannaCry revealed that the timer could be modified using the system clock! Setting the time in Windows to several days in the future — thus missing the first payment deadline — raised the file ransom from USD 300 to USD 600.</p>
<p><img loading=lazy src=/media/fishing-for-malware-3-6.png alt="Screenshot of changing the system time and WannaCry">
</p>
<p>So, then, what happens if the second deadline expires as well? Unfortunately, nothing, so it seems. The timer runs out but then&mldr; Well, the files remain. Not even a pop-up — rather anticlimactic. Further, resetting the system clock refilled the timers and lowered the requested payment back to USD 300.</p>
<p>Speaking of payment, the transaction history of the Bitcoin ransom address can be seen <a href=https://www.blockchain.com/btc/address/115p7UMMngoj1pMvkpHijcRdfJNXj6LrLn>here</a>, but to summarize:</p>
<blockquote>
<p>This address has transacted 124 times on the Bitcoin blockchain. It has received a total of 14.87769994 BTC ($522,558.23) and has sent a total of 14.41067602 BTC ($506,154.68). The current value of this address is 0.46702392 BTC ($16,403.56).</p>
</blockquote>
<p>Finally, attempting to send a message via the <code>Contact Us</code> link, which spawned a text entry box, revealed the following, which leads me to believe that finding a valid connection endpoint would have ultimately been useless, as it would have simply been a TOR node.</p>
<p><img loading=lazy src=/media/fishing-for-malware-3-7.png alt="Screenshot of WannaCry TOR connection failure">
</p>
<p>Overall, while WannaCry isn&rsquo;t as intimidating as in times past, it was still fun to play around with. If the Bitcoin transaction history is indicative of anything, it&rsquo;s that a very profitable subsection of users still open their computers to see WannaCry&rsquo;s infamous red GUI.</p>
<h2 id=examining-wannacry-with-ghidra>Examining WannaCry with Ghidra<a hidden class=anchor aria-hidden=true href=#examining-wannacry-with-ghidra>#</a></h2>
<p>WannaCry has, so far, been only superficially exposed in this post, but <a href=https://ghidra-sre.org/>Ghidra</a> can be used to dive deeper. Before proceeding, I would like to note that I am not by any means proficient, or even knowledgeable, regarding the process of reverse engineering. I am still a student; it is my hope, however, that others might learn as much as I have by reading further.</p>
<p>First, some information regarding the executable:</p>
<pre tabindex=0><code class=language-none data-lang=none>$ file wannacry
wannacry: PE32 executable (GUI) Intel 80386, for MS Windows
</code></pre><pre tabindex=0><code class=language-none data-lang=none>$ strings wannacry

...

CryptAcquireContextA
CryptGenRandom

...

InternetCloseHandle
InternetOpenUrlA
InternetOpenA

..

CryptAcquireContextA
CryptGenRandom

...

SMBs
SMBr
SMBs
SMB+

...
</code></pre><p>In particular, consider the following URL.</p>
<pre tabindex=0><code class=language-none data-lang=none>$ strings wannacry | grep 'http\|https'
http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>$ curl http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com

<span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en-us&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no-js&#34;</span>&gt;
    &lt;<span style=color:#f92672>head</span>&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>&gt;
        &lt;<span style=color:#f92672>title</span>&gt;Sinkholed by Kryptos Logic&lt;/<span style=color:#f92672>title</span>&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;description&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Kryptos Logic Sinkhole&#34;</span>&gt;
        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;//static.kryptoslogicsinkhole.com/style.css&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span>/&gt;
    &lt;/<span style=color:#f92672>head</span>&gt;
    &lt;<span style=color:#f92672>body</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flat&#34;</span>&gt;
        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;content&#34;</span>&gt;
            &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;content-box&#34;</span>&gt;
                &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;big-content&#34;</span>&gt;
                    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;clear&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
                &lt;/<span style=color:#f92672>div</span>&gt;
                &lt;<span style=color:#f92672>h1</span>&gt;Sinkholed!&lt;/<span style=color:#f92672>h1</span>&gt;
                &lt;<span style=color:#f92672>p</span>&gt;This domain has been sinkholed by &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.kryptoslogic.com&#34;</span>&gt;Kryptos Logic&lt;/<span style=color:#f92672>a</span>&gt;.&lt;/<span style=color:#f92672>p</span>&gt;
            &lt;/<span style=color:#f92672>div</span>&gt;
        &lt;/<span style=color:#f92672>div</span>&gt;
    &lt;/<span style=color:#f92672>body</span>&gt;
&lt;/<span style=color:#f92672>html</span>&gt;
</code></pre></div><p>The domain has since been captured, but from a cursory Google search, my understanding is that <a href=https://www.fireeye.com/blog/products-and-services/2017/05/wannacry-ransomware-campaign.html>this was one of the kill-switch sites used to neutralize WannaCry</a>. Here is Ghidra&rsquo;s best attempt to reconstruct the function containing the URL:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>undefined4 <span style=color:#a6e22e>FUN_00408140</span>(<span style=color:#66d9ef>void</span>)

{
  undefined4 uVar1;
  <span style=color:#66d9ef>int</span> iVar2;
  undefined4 <span style=color:#f92672>*</span>puVar3;
  undefined4 <span style=color:#f92672>*</span>puVar4;
  undefined4 uStack100;
  undefined4 uStack96;
  undefined4 uStack92;
  undefined4 local_50 [<span style=color:#ae81ff>14</span>];
  undefined4 local_17;
  undefined4 local_13;
  undefined4 local_f;
  undefined4 local_b;
  undefined4 local_7;
  undefined2 local_3;
  undefined local_1;
  
  puVar3 <span style=color:#f92672>=</span> (undefined4 <span style=color:#f92672>*</span>)s_http:<span style=color:#75715e>//www.iuqerfsodp9ifjaposdfj_004313d0;
</span><span style=color:#75715e></span>  puVar4 <span style=color:#f92672>=</span> local_50;
  <span style=color:#66d9ef>for</span> (iVar2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xe</span>; iVar2 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; iVar2 <span style=color:#f92672>=</span> iVar2 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
    <span style=color:#f92672>*</span>puVar4 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>puVar3;
    puVar3 <span style=color:#f92672>=</span> puVar3 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    puVar4 <span style=color:#f92672>=</span> puVar4 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
  }
  <span style=color:#f92672>*</span>(undefined <span style=color:#f92672>*</span>)puVar4 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>(undefined <span style=color:#f92672>*</span>)puVar3;
  local_17 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_13 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_f <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_b <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  uStack92 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  uStack96 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  uStack100 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  local_1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
  uVar1 <span style=color:#f92672>=</span> InternetOpenA(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>);
  iVar2 <span style=color:#f92672>=</span> InternetOpenUrlA(uVar1,<span style=color:#f92672>&amp;</span>uStack100,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0x84000000</span>,<span style=color:#ae81ff>0</span>);
  <span style=color:#66d9ef>if</span> (iVar2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
    InternetCloseHandle(uVar1);
    InternetCloseHandle(<span style=color:#ae81ff>0</span>);
    FUN_00408090();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
  }
  InternetCloseHandle(uVar1);
  InternetCloseHandle(iVar2);
  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>It appears that <code>InternetOpenA()</code>, for example, is a system call to a function in Microsoft&rsquo;s own <code>WININET.DLL</code>, as shown below, which is contained within the <em>wininet.h</em> header.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=color:#a6e22e>ff</span> <span style=color:#ae81ff>15</span> <span style=color:#ae81ff>34</span> <span style=color:#66d9ef>a1</span> <span style=color:#ae81ff>40</span> <span style=color:#ae81ff>00</span>      <span style=color:#66d9ef>CALL</span>        <span style=color:#66d9ef>dword</span> <span style=color:#66d9ef>ptr</span> [<span style=color:#66d9ef>WININET.DLL</span>::<span style=color:#66d9ef>InternetOpenA</span>]
</code></pre></div><p><a href=https://docs.microsoft.com/en-us/windows/win32/api/wininet/nf-wininet-internetopena>Microsoft says</a> that <code>InternetOpenA()</code> &ldquo;initializes an application&rsquo;s use of the WinINet functions.&rdquo; WannaCry then uses <code>InternetOpenUrlA()</code>, which, also <a href=https://docs.microsoft.com/en-us/windows/win32/api/wininet/nf-wininet-internetopenurla>per Microsoft documentation</a>, &ldquo;opens a resource specified by a complete FTP or HTTP URL.&rdquo;</p>
<p>Consider, then, the following excerpt from <em>The Conversation&rsquo;s</em> 2017 article about WannaCry, <a href=https://theconversation.com/heres-how-the-ransomware-attack-was-stopped-and-why-it-could-soon-start-again-77745><em>Here’s how the ransomware attack was stopped – and why it could soon start again</em></a>:</p>
<blockquote>
<p>In the case of WannaCry, a researcher using the pseudonym MalwareTech ended up accidentally activating the kill switch when he tried to create a sinkhole in order to study the software. WannaCry included code that looked to check if a specified domain had been registered. If it received a response from the domain, it shut down. If not, it continued to work. So when MalwareTech registered the domain, it effectively activated the kill switch.</p>
</blockquote>
<p>So, then, Ghidra&rsquo;s disassembly from above could presumably be annotated with comments like so:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>...

  uVar1 <span style=color:#f92672>=</span> InternetOpenA(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>); <span style=color:#75715e>// Initialize WinInit capability
</span><span style=color:#75715e></span>  iVar2 <span style=color:#f92672>=</span> InternetOpenUrlA(uVar1,<span style=color:#f92672>&amp;</span>uStack100,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0x84000000</span>,<span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Check for a response from the URL 
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (iVar2 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) { <span style=color:#75715e>// If no reponse is received, as domain is unregistered
</span><span style=color:#75715e></span>    InternetCloseHandle(uVar1); <span style=color:#75715e>// Close the socket
</span><span style=color:#75715e></span>    InternetCloseHandle(<span style=color:#ae81ff>0</span>); <span style=color:#75715e>// Close the socket
</span><span style=color:#75715e></span>    FUN_00408090(); <span style=color:#75715e>// !! PROCEED WITH WANNACRY !!
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
  } <span style=color:#75715e>// Otherwise, just close the socket and quit without executing WannaCry
</span><span style=color:#75715e></span>  InternetCloseHandle(uVar1);
  InternetCloseHandle(iVar2);
  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>By this point, my disassembly-related technical skill had been exhausted. Overall, this has certainly been one of the most interesting parts of my honeypot project thus far. Thank you so much for reading and stay tuned; more posts in my <em>Fishing for Malware</em> series will be published soon.</p>
<hr>
<p><strong><a href=/media/fishing-for-malware-4>Fishing for Malware: Part 4 →</a></strong><br>
<strong><a href=/media/fishing-for-malware-2>← Fishing for Malware: Part 2</a></strong></p>
<p>I am open to comments and criticism — I learn alongside you. Please, do not hesitate to <a href="mailto:contact@swlacy.com?subject=Blog%20Edit%20Suggestion">suggest an edit</a>.</p>
<hr>
<p>Sid Lacy<br>
<a href="mailto:contact@swlacy.com?subject=Hello!">Email</a> • <a href=https://www.linkedin.com/in/lacysw/>LinkedIn</a> • <a href=https://github.com/lacysw>GitHub</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://swlacy.com/tags/analysis/>analysis</a></li>
<li><a href=https://swlacy.com/tags/projects/>projects</a></li>
</ul><div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on twitter" href="https://twitter.com/intent/tweet/?text=Fishing%20for%20Malware%20%e2%80%94%20Part%20Three%3a%20WannaCry&url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f&hashtags=analysis%2cprojects"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5.0 86.7-66 186.6-186.6 186.6-37.2.0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7.0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447.0 01-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9.0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48A48 48 0 000 80v352a48 48 0 0048 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.27c-30.81.0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H4e2a48 48 0 0048-48V80a48 48 0 00-48-48z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f&title=Fishing%20for%20Malware%20%e2%80%94%20Part%20Three%3a%20WannaCry"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M283.2 345.5c2.7 2.7 2.7 6.8.0 9.2-24.5 24.5-93.8 24.6-118.4.0-2.7-2.4-2.7-6.5.0-9.2 2.4-2.4 6.5-2.4 8.9.0 18.7 19.2 81 19.6 100.5.0 2.4-2.3 6.6-2.3 9 0zm-91.3-53.8c0-14.9-11.9-26.8-26.5-26.8-14.9.0-26.8 11.9-26.8 26.8.0 14.6 11.9 26.5 26.8 26.5 14.6.0 26.5-11.9 26.5-26.5zm90.7-26.8c-14.6.0-26.5 11.9-26.5 26.8.0 14.6 11.9 26.5 26.5 26.5 14.9.0 26.8-11.9 26.8-26.5.0-14.9-11.9-26.8-26.8-26.8zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5.0 48 21.5 48 48zm-99.7 140.6c-10.1.0-19 4.2-25.6 10.7-24.1-16.7-56.5-27.4-92.5-28.6l18.7-84.2 59.5 13.4c0 14.6 11.9 26.5 26.5 26.5 14.9.0 26.8-12.2 26.8-26.8.0-14.6-11.9-26.8-26.8-26.8-10.4.0-19.3 6.2-23.8 14.9l-65.7-14.6c-3.3-.9-6.5 1.5-7.4 4.8l-20.5 92.8c-35.7 1.5-67.8 12.2-91.9 28.9-6.5-6.8-15.8-11-25.9-11-37.5.0-49.8 50.4-15.5 67.5-1.2 5.4-1.8 11-1.8 16.7.0 56.5 63.7 102.3 141.9 102.3 78.5.0 142.2-45.8 142.2-102.3.0-5.7-.6-11.6-2.1-17 33.6-17.2 21.2-67.2-16.1-67.2z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on ycombinator" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f&t=Fishing%20for%20Malware%20%e2%80%94%20Part%20Three%3a%20WannaCry"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM21.2 229.2H21c.1-.1.2-.3.3-.4.0.1.0.3-.1.4zm218 53.9V384h-31.4V281.3L128 128h37.3c52.5 98.3 49.2 101.2 59.3 125.6 12.3-27 5.8-24.4 60.6-125.6H320l-80.8 155.1z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f&title=Fishing%20for%20Malware%20%e2%80%94%20Part%20Three%3a%20WannaCry"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Fishing for Malware — Part Three: WannaCry on whatsapp" href="https://api.whatsapp.com/send?text=Fishing%20for%20Malware%20%e2%80%94%20Part%20Three%3a%20WannaCry%20-%20https%3a%2f%2fswlacy.com%2fposts%2ffishing-for-malware-3%2f"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 122.8c-72.7.0-131.8 59.1-131.9 131.8.0 24.9 7 49.2 20.2 70.1l3.1 5-13.3 48.6 49.9-13.1 4.8 2.9c20.2 12 43.4 18.4 67.1 18.4h.1c72.6.0 133.3-59.1 133.3-131.8.0-35.2-15.2-68.3-40.1-93.2-25-25-58-38.7-93.2-38.7zm77.5 188.4c-3.3 9.3-19.1 17.7-26.7 18.8-12.6 1.9-22.4.9-47.5-9.9-39.7-17.2-65.7-57.2-67.7-59.8s-16.2-21.5-16.2-41 10.2-29.1 13.9-33.1c3.6-4 7.9-5 10.6-5 2.6.0 5.3.0 7.6.1 2.4.1 5.7-.9 8.9 6.8 3.3 7.9 11.2 27.4 12.2 29.4s1.7 4.3.3 6.9c-7.6 15.2-15.7 14.6-11.6 21.6 15.3 26.3 30.6 35.4 53.9 47.1 4 2 6.3 1.7 8.6-1 2.3-2.6 9.9-11.6 12.5-15.5 2.6-4 5.3-3.3 8.9-2 3.6 1.3 23.1 10.9 27.1 12.9s6.6 3 7.6 4.6c.9 1.9.9 9.9-2.4 19.1zM4e2 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM223.9 413.2c-26.6.0-52.7-6.7-75.8-19.3L64 416l22.5-82.2c-13.9-24-21.2-51.3-21.2-79.3C65.4 167.1 136.5 96 223.9 96c42.4.0 82.2 16.5 112.2 46.5 29.9 30 47.9 69.8 47.9 112.2.0 87.4-72.7 158.5-160.1 158.5z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>Copyright &copy; 2022 Sid Lacy •
Last Built 2022.02.12 UTC •
<a href=/attribution>Attribution</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Jump to Top" class=top-link id=top-link accesskey=g><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" class="svg-inline--fa fa-arrow-up fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='Copy ⧉';function d(){a.innerText='Copied!',setTimeout(()=>{a.innerText='Copy ⧉'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(a=>{mediumZoom(a,{background:'#00000000'})})</script></body>
</html>